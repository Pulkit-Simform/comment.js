<!DOCTYPE html>
<!-- Generated with comment.js -->
<meta charset="utf-8"><title>bbva.ui.dialog.js</title><link rel="stylesheet" href="../css/src.css"><body id="cjs-src"><code id="L1"><span class="ln">1</span><span class="c"><span class="c">/*\</span>
</span></code><code id="L2"><span class="ln">2</span><span class="c"><span class="s"> * </span>$B
</span></code><code id="L3"><span class="ln">3</span><span class="c"><span class="s"> * </span>Global namespace <b>for</b> BBVA
</span></code><code id="L4"><span class="ln">4</span><span class="c">\*/</span>
</code><code id="L5"><span class="ln">5</span>
</code><code id="L6"><span class="ln">6</span><span class="c"><span class="c">/*\</span>
</span></code><code id="L7"><span class="ln">7</span><span class="c"><span class="s"> * </span>$B.ui
</span></code><code id="L8"><span class="ln">8</span><span class="c"><span class="s"> * </span>Global namespace <b>for</b> BBVA UI components
</span></code><code id="L9"><span class="ln">9</span><span class="c">\*/</span>
</code><code id="L10"><span class="ln">10</span>
</code><code id="L11"><span class="ln">11</span><span class="c">// <i>"$B.ui.dialog"</i></span>
</code><code id="L12"><span class="ln">12</span><span class="c"><span class="c">/*\</span>
</span></code><code id="L13"><span class="ln">13</span><span class="c"><span class="s"> * </span>$B.ui.dialog
</span></code><code id="L14"><span class="ln">14</span><span class="c"><span class="s"> * </span>Object to perform any operations related to dialogs
</span></code><code id="L15"><span class="ln">15</span><span class="c">\*/</span>
</code><code id="L16"><span class="ln">16</span>(<b>function</b> ($, window) {
</code><code id="L17"><span class="ln">17</span>
</code><code id="L18"><span class="ln">18</span>  $B.provide($B, <i>'ui.dialog'</i>);
</code><code id="L19"><span class="ln">19</span>
</code><code id="L20"><span class="ln">20</span>  <span class="c">// we need to disable resize on overlay</span>
</code><code id="L21"><span class="ln">21</span>  <span class="c">// original overlay create <b>function</b></span>
</code><code id="L22"><span class="ln">22</span>  <b>var</b> overlayCreate<span class="s"> = </span>$.ui.dialog.overlay.create,
</code><code id="L23"><span class="ln">23</span>    document<span class="s"> = </span>window.document;
</code><code id="L24"><span class="ln">24</span>
</code><code id="L25"><span class="ln">25</span>  <span class="c">// prevent jQuery ui from changing the overlay size (we use css)</span>
</code><code id="L26"><span class="ln">26</span>  $.ui.dialog.overlay.resize<span class="s"> = </span><b>function</b> () {};
</code><code id="L27"><span class="ln">27</span>
</code><code id="L28"><span class="ln">28</span>  <span class="c">// overlay create <b>function</b> wrapper</span>
</code><code id="L29"><span class="ln">29</span>  $.extend($.ui.dialog.overlay, {
</code><code id="L30"><span class="ln">30</span>    create: <b>function</b> (dialog) {
</code><code id="L31"><span class="ln">31</span>      <span class="c">// save reference to <b>return</b></span>
</code><code id="L32"><span class="ln">32</span>      <b>var</b> $el<span class="s"> = </span>overlayCreate.call(<b>this</b>, dialog);
</code><code id="L33"><span class="ln">33</span>
</code><code id="L34"><span class="ln">34</span>      <span class="c">// unbind resize event</span>
</code><code id="L35"><span class="ln">35</span>      $(window).off(<i>'resize.dialog-overlay'</i>);
</code><code id="L36"><span class="ln">36</span>
</code><code id="L37"><span class="ln">37</span>      <span class="c">// restore size</span>
</code><code id="L38"><span class="ln">38</span>      $el.css({
</code><code id="L39"><span class="ln">39</span>        width: <i>'<span class="d">100</span>%'</i>,
</code><code id="L40"><span class="ln">40</span>        height: <i>'<span class="d">100</span>%'</i>
</code><code id="L41"><span class="ln">41</span>      });
</code><code id="L42"><span class="ln">42</span>
</code><code id="L43"><span class="ln">43</span>      <span class="c">// allow scrolling by dragging the scrollbar</span>
</code><code id="L44"><span class="ln">44</span>      <span class="c">// remove (as now we are disabling the entire page scrollbar)</span>
</code><code id="L45"><span class="ln">45</span>      setTimeout(<b>function</b> () {
</code><code id="L46"><span class="ln">46</span>        $(document).off(<i>'mousedown.dialog-overlay'</i>);
</code><code id="L47"><span class="ln">47</span>      }, <span class="d">1</span>);
</code><code id="L48"><span class="ln">48</span>
</code><code id="L49"><span class="ln">49</span>      <span class="c">// <b>return</b> original element</span>
</code><code id="L50"><span class="ln">50</span>      <b>return</b> $el;
</code><code id="L51"><span class="ln">51</span>    }
</code><code id="L52"><span class="ln">52</span>  });
</code><code id="L53"><span class="ln">53</span>
</code><code id="L54"><span class="ln">54</span>  <span class="c">// evento para redimensionar y posicionar ventanas modales</span>
</code><code id="L55"><span class="ln">55</span>  $(window).resize(<b>function</b> (ev) {
</code><code id="L56"><span class="ln">56</span>    $B.ui.dialogCenter();
</code><code id="L57"><span class="ln">57</span>  });
</code><code id="L58"><span class="ln">58</span>
</code><code id="L59"><span class="ln">59</span>  <span class="c">// funcion que se encarga de centrar, redimensionar y aplicar scroll a ventanas modales</span>
</code><code id="L60"><span class="ln">60</span>
</code><code id="L61"><span class="ln">61</span>
</code><code id="L62"><span class="ln">62</span>
</code><code id="L63"><span class="ln">63</span>
</code><code id="L64"><span class="ln">64</span>  <span class="c">////////////////////////////////////</span>
</code><code id="L65"><span class="ln">65</span>  <span class="c">// TEST COMMENT JS PROP DETECTION //</span>
</code><code id="L66"><span class="ln">66</span>  <span class="c">////////////////////////////////////</span>
</code><code id="L67"><span class="ln">67</span>
</code><code id="L68"><span class="ln">68</span><span class="c">  <span class="c">/*\</span>
</span></code><code id="L69"><span class="ln">69</span><span class="c">  <span class="s"> * </span>$B.ui.dialogSecureHeight
</span></code><code id="L70"><span class="ln">70</span><span class="c">   [ property ]
</span></code><code id="L71"><span class="ln">71</span><span class="c">  <span class="s"> * </span>Secure and nice separation from top and bottom of the window
</span></code><code id="L72"><span class="ln">72</span><span class="c">  \*/</span>
</code><code id="L73"><span class="ln">73</span>  $B.ui.dialogSecureHeight<span class="s"> = </span><span class="d">100</span>;
</code><code id="L74"><span class="ln">74</span>
</code><code id="L75"><span class="ln">75</span>
</code><code id="L76"><span class="ln">76</span>
</code><code id="L77"><span class="ln">77</span>  $B.ui.dialogCenter<span class="s"> = </span><b>function</b> ($uiDialog) {
</code><code id="L78"><span class="ln">78</span>    $uiDialog<span class="s"> = </span>$(<i>'.contenidoModal:visible:last'</i>).closest(<i>'.ui-dialog'</i>);
</code><code id="L79"><span class="ln">79</span>
</code><code id="L80"><span class="ln">80</span>    <span class="c">// dont <b>do</b> anything <b>if</b> no modal found</span>
</code><code id="L81"><span class="ln">81</span>    <b>if</b> (!$uiDialog.length) {
</code><code id="L82"><span class="ln">82</span>      <b>return</b>;
</code><code id="L83"><span class="ln">83</span>    }
</code><code id="L84"><span class="ln">84</span>
</code><code id="L85"><span class="ln">85</span>    <b>var</b> $window<span class="s"> = </span>$(window),
</code><code id="L86"><span class="ln">86</span>      windowHeightSecure<span class="s"> = </span>$window.height()<span class="s"> - </span>$B.ui.dialogSecureHeight, <span class="c">// <span class="d">100</span> is the secure margin</span>
</code><code id="L87"><span class="ln">87</span>      $buttonsLayer,
</code><code id="L88"><span class="ln">88</span>      $cuerpoModal,
</code><code id="L89"><span class="ln">89</span>      $contentScroll,
</code><code id="L90"><span class="ln">90</span>      $divViewport,
</code><code id="L91"><span class="ln">91</span>      $divOverview,
</code><code id="L92"><span class="ln">92</span>      $divScrollbar,
</code><code id="L93"><span class="ln">93</span>      $divScrollable,
</code><code id="L94"><span class="ln">94</span>      $elementToScroll,
</code><code id="L95"><span class="ln">95</span>      stepsButtonsHeight,
</code><code id="L96"><span class="ln">96</span>      contentMarginTop,
</code><code id="L97"><span class="ln">97</span>      $contenidoModal,
</code><code id="L98"><span class="ln">98</span>      $buttonsMirrored,
</code><code id="L99"><span class="ln">99</span>      needsToInitScroll<span class="s"> = </span><b>true</b>,
</code><code id="L100"><span class="ln">100</span>      <span class="c">// <b>if</b> fixed height, <b>do</b> not resize</span>
</code><code id="L101"><span class="ln">101</span>      needsResize<span class="s"> = </span>$uiDialog.find(<i>'[data-fixed-height]'</i>).length ? <b>false</b> : <b>true</b>,
</code><code id="L102"><span class="ln">102</span>      buttonAreaCopied<span class="s"> = </span><b>false</b>,
</code><code id="L103"><span class="ln">103</span>      buttonAreaClasses,
</code><code id="L104"><span class="ln">104</span>      divScrollableHeight,
</code><code id="L105"><span class="ln">105</span>      <span class="c">// flag to know <b>if</b> its <i>"modalDetalle"</i> type</span>
</code><code id="L106"><span class="ln">106</span>      isModalDetalle<span class="s"> = </span>$uiDialog.hasClass(<i>'c-contenedores-modalDetalle'</i>),
</code><code id="L107"><span class="ln">107</span>      altoCalculado,
</code><code id="L108"><span class="ln">108</span>
</code><code id="L109"><span class="ln">109</span>      <span class="c">// centers the modal on the window</span>
</code><code id="L110"><span class="ln">110</span>      centerModal<span class="s"> = </span><b>function</b> () {
</code><code id="L111"><span class="ln">111</span>        <b>var</b> top<span class="s"> = </span>($window.height()<span class="s"> - </span>$uiDialog.outerHeight())<span class="s"> / </span><span class="d">2</span>;
</code><code id="L112"><span class="ln">112</span>        $uiDialog.css({
</code><code id="L113"><span class="ln">113</span>          position: <i>'fixed'</i>,
</code><code id="L114"><span class="ln">114</span>          left: ($window.width()<span class="s"> - </span>$uiDialog.width())<span class="s"> / </span><span class="d">2</span><span class="s"> + </span>$window.scrollLeft(),
</code><code id="L115"><span class="ln">115</span>          top: (top &lt; <span class="d">0</span>) ? <span class="d">0</span> : top
</code><code id="L116"><span class="ln">116</span>        });
</code><code id="L117"><span class="ln">117</span>      },
</code><code id="L118"><span class="ln">118</span>
</code><code id="L119"><span class="ln">119</span>      <span class="c">// initializes the custom scroll on the corresponding container</span>
</code><code id="L120"><span class="ln">120</span>      initCustomScroll<span class="s"> = </span><b>function</b> () {
</code><code id="L121"><span class="ln">121</span>        <span class="c">// fix some style problems <b>if</b> modal is modalDetalle</span>
</code><code id="L122"><span class="ln">122</span>        <b>if</b> (isModalDetalle) {
</code><code id="L123"><span class="ln">123</span>          <span class="c">// change scrollbar position</span>
</code><code id="L124"><span class="ln">124</span>          $divScrollbar.css({
</code><code id="L125"><span class="ln">125</span>            right: -<span class="d">16</span>
</code><code id="L126"><span class="ln">126</span>          });
</code><code id="L127"><span class="ln">127</span>          <span class="c">// add padding to viewport</span>
</code><code id="L128"><span class="ln">128</span>          $divViewport.css({
</code><code id="L129"><span class="ln">129</span>            paddingRight: <span class="d">16</span>
</code><code id="L130"><span class="ln">130</span>          });
</code><code id="L131"><span class="ln">131</span>        }
</code><code id="L132"><span class="ln">132</span>
</code><code id="L133"><span class="ln">133</span>        <span class="c">// get the element to make it scrollable</span>
</code><code id="L134"><span class="ln">134</span>        $elementToScroll<span class="s"> = </span>$contentScroll.children(<i>':first'</i>).hasClass(<i>'scrollbar'</i>) ? $contentScroll.find(<i>'.scrollable'</i>).first() : $contentScroll.children(<i>':first'</i>);
</code><code id="L135"><span class="ln">135</span>        <span class="c">// destroy any previous reference tu customscroll plugin</span>
</code><code id="L136"><span class="ln">136</span>        $elementToScroll.parent().customScrollbar(<i>'destroy'</i>);
</code><code id="L137"><span class="ln">137</span>
</code><code id="L138"><span class="ln">138</span>        <span class="c">// init plugin <b>if</b> the scrollable content is higher than its container</span>
</code><code id="L139"><span class="ln">139</span>        <b>if</b> ($elementToScroll.height()<span class="s"> + </span><span class="d">10</span> > $elementToScroll.parent().height()) {
</code><code id="L140"><span class="ln">140</span>          <span class="c">// show scrollbar (initially is hidden)</span>
</code><code id="L141"><span class="ln">141</span>          $divScrollbar.show();
</code><code id="L142"><span class="ln">142</span>          $elementToScroll.parent().customScrollbar({ resizeContent : <b>false</b> });
</code><code id="L143"><span class="ln">143</span>          $divScrollable.css(<i>'margin-top'</i>, contentMarginTop);
</code><code id="L144"><span class="ln">144</span>        }
</code><code id="L145"><span class="ln">145</span>
</code><code id="L146"><span class="ln">146</span>        <span class="c">//set contentScroll margin-top on init</span>
</code><code id="L147"><span class="ln">147</span>        <b>if</b> ($contentScroll.data(<i>'tsb'</i>)) {
</code><code id="L148"><span class="ln">148</span>          $contentScroll.data(<i>'tsb'</i>).thumbSetPos();
</code><code id="L149"><span class="ln">149</span>        }
</code><code id="L150"><span class="ln">150</span>      },
</code><code id="L151"><span class="ln">151</span>
</code><code id="L152"><span class="ln">152</span>      <span class="c">// removes the scroll and reset styles of the elements</span>
</code><code id="L153"><span class="ln">153</span>      removeCustomScroll<span class="s"> = </span><b>function</b> () {
</code><code id="L154"><span class="ln">154</span>        <b>var</b> defaultStyles<span class="s"> = </span>{ height: <i>'auto'</i> };
</code><code id="L155"><span class="ln">155</span>        $divScrollbar.hide();
</code><code id="L156"><span class="ln">156</span>        $cuerpoModal.find(<i>'.contenedorScroll'</i>).css(defaultStyles).customScrollbar(<i>'destroy'</i>);
</code><code id="L157"><span class="ln">157</span>        $cuerpoModal.css(defaultStyles);
</code><code id="L158"><span class="ln">158</span>        $contenidoModal.css(defaultStyles);
</code><code id="L159"><span class="ln">159</span>        $uiDialog.css(defaultStyles);
</code><code id="L160"><span class="ln">160</span>        $divOverview.css($.extend({}, defaultStyles, { position: <i>'<b>static</b>'</i> }));
</code><code id="L161"><span class="ln">161</span>        $divViewport.css($.extend({}, defaultStyles, { overflow: <i>'visible'</i> }));
</code><code id="L162"><span class="ln">162</span>        <span class="c">// <b>do</b> not need scrollbars, mark to <b>false</b></span>
</code><code id="L163"><span class="ln">163</span>        needsToInitScroll<span class="s"> = </span><b>false</b>;
</code><code id="L164"><span class="ln">164</span>      },
</code><code id="L165"><span class="ln">165</span>
</code><code id="L166"><span class="ln">166</span>      getCalculatedHeight<span class="s"> = </span><b>function</b> () {
</code><code id="L167"><span class="ln">167</span>        <b>var</b> maxHeight, resultHeight;
</code><code id="L168"><span class="ln">168</span>
</code><code id="L169"><span class="ln">169</span>        <span class="c">// reset overview position because <b>if</b> not, as its absolute</span>
</code><code id="L170"><span class="ln">170</span>        <span class="c">// doesnt stretches to the width of the content and makes the content div be too tall</span>
</code><code id="L171"><span class="ln">171</span>        $divOverview.css(<i>'position'</i>, <i>'<b>static</b>'</i>);
</code><code id="L172"><span class="ln">172</span>
</code><code id="L173"><span class="ln">173</span>        _.find($(<i>'.scrollable'</i>), <b>function</b> (item) {
</code><code id="L174"><span class="ln">174</span>          <b>if</b> (!$(item).closest(<i>'.scrollable'</i>).length<span class="s"> &amp;&amp; </span>$(item).height() > <span class="d">0</span>) {
</code><code id="L175"><span class="ln">175</span>            maxHeight<span class="s"> = </span>$(item).height();
</code><code id="L176"><span class="ln">176</span>          }
</code><code id="L177"><span class="ln">177</span>        });
</code><code id="L178"><span class="ln">178</span>
</code><code id="L179"><span class="ln">179</span>        <b>if</b> (maxHeight &lt; $contentScroll.height()<span class="s"> || </span>maxHeight > $divOverview.height()) {
</code><code id="L180"><span class="ln">180</span>          resultHeight<span class="s"> = </span>maxHeight;
</code><code id="L181"><span class="ln">181</span>        } <b>else</b> {
</code><code id="L182"><span class="ln">182</span>          resultHeight<span class="s"> = </span>Math.max($contentScroll.height(), $divOverview.height());
</code><code id="L183"><span class="ln">183</span>        }
</code><code id="L184"><span class="ln">184</span>
</code><code id="L185"><span class="ln">185</span>        <span class="c">// restore overview position</span>
</code><code id="L186"><span class="ln">186</span>        $divOverview.css(<i>'position'</i>, <i>'absolute'</i>);
</code><code id="L187"><span class="ln">187</span>
</code><code id="L188"><span class="ln">188</span>        <b>return</b> resultHeight;
</code><code id="L189"><span class="ln">189</span>      },
</code><code id="L190"><span class="ln">190</span>
</code><code id="L191"><span class="ln">191</span>      recalculateContainersHeight<span class="s"> = </span><b>function</b> (altoContenido) {
</code><code id="L192"><span class="ln">192</span>        <b>var</b> variationContenidoModal<span class="s"> = </span>isModalDetalle ? <span class="d">0</span> : <span class="d">39</span>,
</code><code id="L193"><span class="ln">193</span>          variationCuerpoModal<span class="s"> = </span>isModalDetalle ? <span class="d">47</span> : <span class="d">0</span>,
</code><code id="L194"><span class="ln">194</span>          uiDialogHeight<span class="s"> = </span>$uiDialog.height();
</code><code id="L195"><span class="ln">195</span>
</code><code id="L196"><span class="ln">196</span>        <span class="c">// si la modal no necesita scroll se lo quitamos</span>
</code><code id="L197"><span class="ln">197</span>        <b>if</b> ((altoContenido &lt; uiDialogHeight<span class="s"> &amp;&amp; </span>uiDialogHeight &lt;= windowHeightSecure)<span class="s"> || </span>$uiDialog.find(<i>'[data-modal-no-scroll]'</i>).length) {
</code><code id="L198"><span class="ln">198</span>          removeCustomScroll();
</code><code id="L199"><span class="ln">199</span>
</code><code id="L200"><span class="ln">200</span>        <span class="c">// caso en que la ventana modal es mas grande que la ventana</span>
</code><code id="L201"><span class="ln">201</span>        } <b>else</b> <b>if</b> ($cuerpoModal.height() &lt; $divScrollable.height() ||
</code><code id="L202"><span class="ln">202</span>            uiDialogHeight > windowHeightSecure ||
</code><code id="L203"><span class="ln">203</span>            ($cuerpoModal.outerHeight() > uiDialogHeight<span class="s"> &amp;&amp; </span>$uiDialog.find(<i>'.scrollable'</i>).length &lt; <span class="d">2</span>)) {
</code><code id="L204"><span class="ln">204</span>
</code><code id="L205"><span class="ln">205</span>          $divOverview.css(<i>'position'</i>, <i>'absolute'</i>);
</code><code id="L206"><span class="ln">206</span>          $divViewport.css(<i>'overflow'</i>, <i>'hidden'</i>);
</code><code id="L207"><span class="ln">207</span>          $uiDialog.css(<i>'height'</i>, windowHeightSecure);
</code><code id="L208"><span class="ln">208</span>          $contenidoModal.css(<i>'height'</i>, $uiDialog.height()<span class="s"> - </span>variationContenidoModal);
</code><code id="L209"><span class="ln">209</span>          $cuerpoModal.css(<i>'height'</i>, $contenidoModal.height()<span class="s"> - </span>$B.ui.dialogCenterGetHeaderModalHeight($contenidoModal)<span class="s"> - </span>stepsButtonsHeight<span class="s"> - </span>$B.ui.dialogCenterGetContentScrollHeight($contentScroll)<span class="s"> - </span>variationCuerpoModal);
</code><code id="L210"><span class="ln">210</span>
</code><code id="L211"><span class="ln">211</span>          <b>if</b> (needsToInitScroll) {
</code><code id="L212"><span class="ln">212</span>            $contentScroll.css(<i>'height'</i>, $cuerpoModal.height());
</code><code id="L213"><span class="ln">213</span>          }
</code><code id="L214"><span class="ln">214</span>
</code><code id="L215"><span class="ln">215</span>        } <b>else</b> {
</code><code id="L216"><span class="ln">216</span>          needsToInitScroll<span class="s"> = </span><b>false</b>;
</code><code id="L217"><span class="ln">217</span>        }
</code><code id="L218"><span class="ln">218</span>      },
</code><code id="L219"><span class="ln">219</span>
</code><code id="L220"><span class="ln">220</span>      <span class="c">// get containers</span>
</code><code id="L221"><span class="ln">221</span>      getContainers<span class="s"> = </span><b>function</b> () {
</code><code id="L222"><span class="ln">222</span>        $contenidoModal<span class="s"> = </span>$uiDialog.find(<i>'.contenidoModal'</i>).first().css(<i>'height'</i>, <i>'auto'</i>);
</code><code id="L223"><span class="ln">223</span>        $contentScroll<span class="s"> = </span>$cuerpoModal.find(<i>'.contenedorScrollModal'</i>).removeAttr(<i>'style'</i>);
</code><code id="L224"><span class="ln">224</span>        $divViewport<span class="s"> = </span>$contentScroll.find(<i>'.viewportModal'</i>).removeAttr(<i>'style'</i>);
</code><code id="L225"><span class="ln">225</span>        $divOverview<span class="s"> = </span>$contentScroll.find(<i>'.overviewModal'</i>).removeAttr(<i>'style'</i>);
</code><code id="L226"><span class="ln">226</span>        $divScrollable<span class="s"> = </span>$contentScroll.find(<i>'.scrollableModal'</i>).removeAttr(<i>'style'</i>);
</code><code id="L227"><span class="ln">227</span>        $divScrollbar<span class="s"> = </span>$contentScroll.find(<i>'.scrollbarModal'</i>).removeAttr(<i>'style'</i>).css(<i>'display'</i>, <i>'none'</i>);
</code><code id="L228"><span class="ln">228</span>      },
</code><code id="L229"><span class="ln">229</span>
</code><code id="L230"><span class="ln">230</span>      checkIframe<span class="s"> = </span><b>function</b> () {
</code><code id="L231"><span class="ln">231</span>        <span class="c">// <b>if</b> there is only an iframe <b>in</b> the modal deactivate custom scroll</span>
</code><code id="L232"><span class="ln">232</span>        <b>if</b> ($cuerpoModal.children().length<span class="s"> === </span><span class="d">1</span><span class="s"> &amp;&amp; </span>$cuerpoModal.find(<i>'iframe'</i>).length) {
</code><code id="L233"><span class="ln">233</span>          needsToInitScroll<span class="s"> = </span><b>false</b>;
</code><code id="L234"><span class="ln">234</span>          <span class="c">// resize the iframe to occupy the whole content</span>
</code><code id="L235"><span class="ln">235</span>          <b>if</b> (needsResize) {
</code><code id="L236"><span class="ln">236</span>            $cuerpoModal.find(<i>'iframe'</i>).css({ height: <i>'<span class="d">100</span>%'</i>, width: <i>'<span class="d">100</span>%'</i> });
</code><code id="L237"><span class="ln">237</span>          } <b>else</b> {
</code><code id="L238"><span class="ln">238</span>            $uiDialog.find(<i>'.overviewModal'</i>).css({ position: <i>'<b>static</b>'</i> });
</code><code id="L239"><span class="ln">239</span>          }
</code><code id="L240"><span class="ln">240</span>        }
</code><code id="L241"><span class="ln">241</span>      };
</code><code id="L242"><span class="ln">242</span>
</code><code id="L243"><span class="ln">243</span>    $cuerpoModal<span class="s"> = </span>$uiDialog.find(<i>'.cuerpoModal'</i>).first();
</code><code id="L244"><span class="ln">244</span>    $B.ui.dialogCenterAddWrapperScroll($cuerpoModal);
</code><code id="L245"><span class="ln">245</span>
</code><code id="L246"><span class="ln">246</span>    <span class="c">// check <b>if</b> there is an iframe and disabled needsToInitScroll</span>
</code><code id="L247"><span class="ln">247</span>    checkIframe();
</code><code id="L248"><span class="ln">248</span>
</code><code id="L249"><span class="ln">249</span>    <b>if</b> (needsToInitScroll) {
</code><code id="L250"><span class="ln">250</span>      getContainers();
</code><code id="L251"><span class="ln">251</span>      contentMarginTop<span class="s"> = </span>$divScrollable.css(<i>'margin-top'</i>); <span class="c">//guardamos margin-top para al iniciar el scroll dejarlo en la misma posicion</span>
</code><code id="L252"><span class="ln">252</span>
</code><code id="L253"><span class="ln">253</span>      <span class="c">// height of the bottom menu <b>if</b> any</span>
</code><code id="L254"><span class="ln">254</span>      stepsButtonsHeight<span class="s"> = </span>($buttonsMirrored) ? $buttonsMirrored.outerHeight(<b>true</b>) : <span class="d">0</span>;
</code><code id="L255"><span class="ln">255</span>
</code><code id="L256"><span class="ln">256</span>      altoCalculado<span class="s"> = </span>getCalculatedHeight();
</code><code id="L257"><span class="ln">257</span>
</code><code id="L258"><span class="ln">258</span>      <span class="c">// set sizes <b>for</b> both viewport and overview containers</span>
</code><code id="L259"><span class="ln">259</span>      $divViewport.add($divOverview).css({
</code><code id="L260"><span class="ln">260</span>        height: altoCalculado,
</code><code id="L261"><span class="ln">261</span>        width: $contentScroll.width()
</code><code id="L262"><span class="ln">262</span>      });
</code><code id="L263"><span class="ln">263</span>
</code><code id="L264"><span class="ln">264</span>      <span class="c">// resize or reset modal dimensions</span>
</code><code id="L265"><span class="ln">265</span>      recalculateContainersHeight(altoCalculado);
</code><code id="L266"><span class="ln">266</span>
</code><code id="L267"><span class="ln">267</span>      <span class="c">// init scroll <b>if</b> needed</span>
</code><code id="L268"><span class="ln">268</span>      <b>if</b> (needsToInitScroll) {
</code><code id="L269"><span class="ln">269</span>        initCustomScroll();
</code><code id="L270"><span class="ln">270</span>      }
</code><code id="L271"><span class="ln">271</span>    }
</code><code id="L272"><span class="ln">272</span>
</code><code id="L273"><span class="ln">273</span>    <span class="c">// center the modal now that al dimensions are <i>"properly"</i> set</span>
</code><code id="L274"><span class="ln">274</span>    setTimeout(<b>function</b> () {
</code><code id="L275"><span class="ln">275</span>      centerModal();
</code><code id="L276"><span class="ln">276</span>    }, <span class="d">0</span>);
</code><code id="L277"><span class="ln">277</span>
</code><code id="L278"><span class="ln">278</span>    <span class="c">// init timer to check modal content changes</span>
</code><code id="L279"><span class="ln">279</span>    $B.checkContentHeightDialogs.init();
</code><code id="L280"><span class="ln">280</span>  };
</code><code id="L281"><span class="ln">281</span>
</code><code id="L282"><span class="ln">282</span>  <span class="c">// <b>if</b> scrollable wrappers are not present, add them (e.g. modalDetalle)</span>
</code><code id="L283"><span class="ln">283</span>  $B.ui.dialogCenterAddWrapperScroll<span class="s"> = </span><b>function</b> ($cuerpoModal) {
</code><code id="L284"><span class="ln">284</span>    <b>if</b> (!$cuerpoModal.children(<i>'.contenedorScroll'</i>).length) {
</code><code id="L285"><span class="ln">285</span>      $cuerpoModal.children().wrapAll(<i>'&lt;div <b>class</b>="contenedorScroll contenedorScrollModal">&lt;div <b>class</b>="viewport viewportModal">&lt;div <b>class</b>="overview overviewModal">&lt;div <b>class</b>="scrollable scrollableModal">&lt;/div>&lt;/div>&lt;/div>&lt;/div>'</i>);
</code><code id="L286"><span class="ln">286</span>      $cuerpoModal.find(<i>'.scrollableModal'</i>).before(<i>'&lt;div <b>class</b>="scrollbar scrollbarModal" style="display:none;">&lt;div <b>class</b>="boxScroll">&lt;div <b>class</b>="track">&lt;div <b>class</b>="thumb">&lt;div <b>class</b>="end">&lt;/div>&lt;/div>&lt;/div>&lt;span <b>class</b>="jspArrow jspArrowUp jspDisabled">&lt;/span>&lt;span <b>class</b>="jspArrow jspArrowDown">&lt;/span>&lt;/div>&lt;/div>'</i>);
</code><code id="L287"><span class="ln">287</span>    }
</code><code id="L288"><span class="ln">288</span>  };
</code><code id="L289"><span class="ln">289</span>
</code><code id="L290"><span class="ln">290</span>  $B.ui.dialogCenterGetHeaderModalHeight<span class="s"> = </span><b>function</b> ($contenidoModal) {
</code><code id="L291"><span class="ln">291</span>    <b>return</b> ($contenidoModal.find(<i>'.headerModal'</i>).length > <span class="d">0</span>) ? $contenidoModal.find(<i>'.headerModal'</i>).outerHeight(<b>true</b>) : <span class="d">0</span>;
</code><code id="L292"><span class="ln">292</span>  };
</code><code id="L293"><span class="ln">293</span>
</code><code id="L294"><span class="ln">294</span>  $B.ui.dialogCenterGetContentScrollHeight<span class="s"> = </span><b>function</b> ($contentScroll) {
</code><code id="L295"><span class="ln">295</span>    <b>return</b> ($contentScroll.length) ? parseInt($contentScroll.css(<i>'paddingTop'</i>), <span class="d">10</span>) : <span class="d">0</span>;
</code><code id="L296"><span class="ln">296</span>  };
</code><code id="L297"><span class="ln">297</span>
</code><code id="L298"><span class="ln">298</span>  $B.ui.dialogHasSecureHeight<span class="s"> = </span><b>function</b> () {
</code><code id="L299"><span class="ln">299</span>    <b>var</b> $uiDialog<span class="s"> = </span>$(<i>'.contenidoModal:visible:last'</i>).closest(<i>'.ui-dialog'</i>);
</code><code id="L300"><span class="ln">300</span>    <b>return</b> ($uiDialog.find(<i>'[data-modal-no-scroll]'</i>).length<span class="s"> === </span><span class="d">1</span><span class="s"> || </span>$uiDialog.find(<i>'[data-fixed-height]'</i>).length ||
</code><code id="L301"><span class="ln">301</span>      $uiDialog.height() &lt;= $(window).height()<span class="s"> - </span>$B.ui.dialogSecureHeight);
</code><code id="L302"><span class="ln">302</span>  };
</code><code id="L303"><span class="ln">303</span>
</code><code id="L304"><span class="ln">304</span>  $B.ui.dialog<span class="s"> = </span>(<b>function</b> () {
</code><code id="L305"><span class="ln">305</span>    <b>var</b> self<span class="s"> = </span>{},
</code><code id="L306"><span class="ln">306</span>      privates<span class="s"> = </span>{},
</code><code id="L307"><span class="ln">307</span>      helpers<span class="s"> = </span>{},
</code><code id="L308"><span class="ln">308</span>      coreDialogs<span class="s"> = </span>{},
</code><code id="L309"><span class="ln">309</span>      dialogs<span class="s"> = </span>{},
</code><code id="L310"><span class="ln">310</span>      toString<span class="s"> = </span>Object.prototype.toString;
</code><code id="L311"><span class="ln">311</span>
</code><code id="L312"><span class="ln">312</span>    <span class="c">// Helper methods</span>
</code><code id="L313"><span class="ln">313</span>
</code><code id="L314"><span class="ln">314</span>    <span class="c">// Check <b>if</b> obj is an object</span>
</code><code id="L315"><span class="ln">315</span>    helpers.isFunction<span class="s"> = </span><b>function</b> (obj) {
</code><code id="L316"><span class="ln">316</span>      <b>return</b> toString.call(obj)<span class="s"> === </span><i>'[object Function]'</i>;
</code><code id="L317"><span class="ln">317</span>    };
</code><code id="L318"><span class="ln">318</span>
</code><code id="L319"><span class="ln">319</span>    helpers.isObject<span class="s"> = </span><b>function</b> (obj) {
</code><code id="L320"><span class="ln">320</span>      <b>return</b> toString.call(obj)<span class="s"> === </span><i>'[object Object]'</i>;
</code><code id="L321"><span class="ln">321</span>    };
</code><code id="L322"><span class="ln">322</span>
</code><code id="L323"><span class="ln">323</span>    <span class="c">// Check <b>if</b> obj is a string</span>
</code><code id="L324"><span class="ln">324</span>    helpers.isString<span class="s"> = </span><b>function</b> (obj) {
</code><code id="L325"><span class="ln">325</span>      <b>return</b> toString.call(obj)<span class="s"> === </span><i>'[object String]'</i>;
</code><code id="L326"><span class="ln">326</span>    };
</code><code id="L327"><span class="ln">327</span>
</code><code id="L328"><span class="ln">328</span>
</code><code id="L329"><span class="ln">329</span>    <span class="c">// Private methods</span>
</code><code id="L330"><span class="ln">330</span>
</code><code id="L331"><span class="ln">331</span>    <span class="c">// add dialog to dialogs array</span>
</code><code id="L332"><span class="ln">332</span>    privates.add<span class="s"> = </span><b>function</b> (id, $dialog, isCore) {
</code><code id="L333"><span class="ln">333</span>      <b>if</b> (isCore) {
</code><code id="L334"><span class="ln">334</span>        coreDialogs[id]<span class="s"> = </span>$dialog;
</code><code id="L335"><span class="ln">335</span>      } <b>else</b> {
</code><code id="L336"><span class="ln">336</span>        dialogs[id]<span class="s"> = </span>$dialog;
</code><code id="L337"><span class="ln">337</span>      }
</code><code id="L338"><span class="ln">338</span>    };
</code><code id="L339"><span class="ln">339</span>
</code><code id="L340"><span class="ln">340</span>    <span class="c">// <b>delete</b> dialog from dialogs array</span>
</code><code id="L341"><span class="ln">341</span>    privates.del<span class="s"> = </span><b>function</b> (id, isCore) {
</code><code id="L342"><span class="ln">342</span>      <b>if</b> (isCore) {
</code><code id="L343"><span class="ln">343</span>        <b>delete</b> coreDialogs[id];
</code><code id="L344"><span class="ln">344</span>      } <b>else</b> {
</code><code id="L345"><span class="ln">345</span>        <b>delete</b> dialogs[id];
</code><code id="L346"><span class="ln">346</span>      }
</code><code id="L347"><span class="ln">347</span>    };
</code><code id="L348"><span class="ln">348</span>
</code><code id="L349"><span class="ln">349</span>    privates.undelegateEvent<span class="s"> = </span><b>function</b> (id, isCore) {
</code><code id="L350"><span class="ln">350</span>      <b>var</b> button,
</code><code id="L351"><span class="ln">351</span>        $dialog<span class="s"> = </span>isCore ? coreDialogs[id] : dialogs[id];
</code><code id="L352"><span class="ln">352</span>
</code><code id="L353"><span class="ln">353</span>      button<span class="s"> = </span>$dialog.dialog(<i>'option'</i>, <i>'trigger'</i>);
</code><code id="L354"><span class="ln">354</span>      <b>if</b> (button) {
</code><code id="L355"><span class="ln">355</span>        $(document).off(<i>'click.b-dialog-open'</i>, button.selector);
</code><code id="L356"><span class="ln">356</span>      }
</code><code id="L357"><span class="ln">357</span>    };
</code><code id="L358"><span class="ln">358</span>
</code><code id="L359"><span class="ln">359</span>    <span class="c">// make the dialog always tabbable when open</span>
</code><code id="L360"><span class="ln">360</span>    privates.fixDialogTabbing<span class="s"> = </span><b>function</b> ($dialog, $uiDialog) {
</code><code id="L361"><span class="ln">361</span>      <b>var</b> firstTabbable<span class="s"> = </span>$(<i>'body'</i>).find(<i>':tabbable:first'</i>),
</code><code id="L362"><span class="ln">362</span>        lastTabbable<span class="s"> = </span>$(<i>'body'</i>).find(<i>':tabbable:last'</i>),
</code><code id="L363"><span class="ln">363</span>        dialogFirstTabbable,
</code><code id="L364"><span class="ln">364</span>        focusDialogFirstTabbable<span class="s"> = </span><b>function</b> () {
</code><code id="L365"><span class="ln">365</span>          dialogFirstTabbable.focus();
</code><code id="L366"><span class="ln">366</span>        },
</code><code id="L367"><span class="ln">367</span>        focusEvent<span class="s"> = </span><i>'focus.fixTabToDialog'</i>,
</code><code id="L368"><span class="ln">368</span>        dialogTrigger<span class="s"> = </span>$dialog.dialog(<i>'trigger'</i>);
</code><code id="L369"><span class="ln">369</span>
</code><code id="L370"><span class="ln">370</span>      $dialog
</code><code id="L371"><span class="ln">371</span>        .on(<i>'dialogopen'</i>, <b>function</b> () {
</code><code id="L372"><span class="ln">372</span>          dialogFirstTabbable<span class="s"> = </span>$uiDialog.find(<i>':tabbable:first'</i>);
</code><code id="L373"><span class="ln">373</span>          firstTabbable.on(focusEvent, focusDialogFirstTabbable);
</code><code id="L374"><span class="ln">374</span>          lastTabbable.on(focusEvent, focusDialogFirstTabbable);
</code><code id="L375"><span class="ln">375</span>        })
</code><code id="L376"><span class="ln">376</span>        .on(<i>'dialogclose'</i>, <b>function</b> (event) {
</code><code id="L377"><span class="ln">377</span>          firstTabbable.off(focusEvent);
</code><code id="L378"><span class="ln">378</span>          lastTabbable.off(focusEvent);
</code><code id="L379"><span class="ln">379</span>          <span class="c">// <b>return</b> focus to the trigger</span>
</code><code id="L380"><span class="ln">380</span>          <b>if</b> (dialogTrigger) {
</code><code id="L381"><span class="ln">381</span>            dialogTrigger.focus();
</code><code id="L382"><span class="ln">382</span>          }
</code><code id="L383"><span class="ln">383</span>        });
</code><code id="L384"><span class="ln">384</span>    };
</code><code id="L385"><span class="ln">385</span>
</code><code id="L386"><span class="ln">386</span>    privates.reset<span class="s"> = </span><b>function</b> ($dialog) {
</code><code id="L387"><span class="ln">387</span>      <b>var</b> form<span class="s"> = </span>$dialog.find(<i>'form'</i>)[<span class="d">0</span>];
</code><code id="L388"><span class="ln">388</span>      <b>if</b> (form) {
</code><code id="L389"><span class="ln">389</span>        $dialog.on(<i>'dialogclose'</i>, <b>function</b> (ev) {
</code><code id="L390"><span class="ln">390</span>          form.reset();
</code><code id="L391"><span class="ln">391</span>        });
</code><code id="L392"><span class="ln">392</span>      }
</code><code id="L393"><span class="ln">393</span>    };
</code><code id="L394"><span class="ln">394</span>
</code><code id="L395"><span class="ln">395</span>    privates.setWidth<span class="s"> = </span><b>function</b> ($dialog, $uiDialog) {
</code><code id="L396"><span class="ln">396</span>      <b>var</b> widthClass<span class="s"> = </span>$dialog.data(<i>'dialog-width'</i>);
</code><code id="L397"><span class="ln">397</span>      <b>if</b> (widthClass) {
</code><code id="L398"><span class="ln">398</span>        $uiDialog.addClass(widthClass);
</code><code id="L399"><span class="ln">399</span>      }
</code><code id="L400"><span class="ln">400</span>    };
</code><code id="L401"><span class="ln">401</span>
</code><code id="L402"><span class="ln">402</span><span class="c">    <span class="c">/*\</span>
</span></code><code id="L403"><span class="ln">403</span><span class="c">    <span class="s"> * </span>$B.ui.dialog.get
</span></code><code id="L404"><span class="ln">404</span><span class="c">     [ method ]
</span></code><code id="L405"><span class="ln">405</span><span class="c">    <span class="s"> * </span>Get an existing dialog <b>with</b> the given id or any of its ui dialog options
</span></code><code id="L406"><span class="ln">406</span><span class="c">     > Arguments
</span></code><code id="L407"><span class="ln">407</span><span class="c">    <span class="s"> - </span>id (string) id of the dialog
</span></code><code id="L408"><span class="ln">408</span><span class="c">    <span class="s"> - </span>option (string) #optional get the value of ui dialog option (<b>for</b> setting a value see @$B.ui.dialog.set)
</span></code><code id="L409"><span class="ln">409</span><span class="c">    <span class="s"> = </span>(object) jQuery object of the dialog content <b>if</b> only the id is pass
</span></code><code id="L410"><span class="ln">410</span><span class="c">    <span class="s"> * </span>or <b>if</b> an option is passed
</span></code><code id="L411"><span class="ln">411</span><span class="c">    <span class="s"> = </span>(any) Value of the specified option
</span></code><code id="L412"><span class="ln">412</span><span class="c">     > Usage
</span></code><code id="L413"><span class="ln">413</span><span class="c">    <span class="s"> | </span>$B.ui.dialog.get(<i>'id'</i>)
</span></code><code id="L414"><span class="ln">414</span><span class="c">    <span class="s"> | </span>$B.ui.dialog.get(<i>'id'</i>, <i>'zIndex'</i>)
</span></code><code id="L415"><span class="ln">415</span><span class="c">    \*/</span>
</code><code id="L416"><span class="ln">416</span>
</code><code id="L417"><span class="ln">417</span><span class="c">    <span class="c">/*\</span>
</span></code><code id="L418"><span class="ln">418</span><span class="c">    <span class="s"> * </span>$B.ui.dialog.get
</span></code><code id="L419"><span class="ln">419</span><span class="c">     [ method ]
</span></code><code id="L420"><span class="ln">420</span><span class="c">    <span class="s"> * </span>Get an existing dialog <b>with</b> the given id or any of its ui dialog options
</span></code><code id="L421"><span class="ln">421</span><span class="c">     > Arguments
</span></code><code id="L422"><span class="ln">422</span><span class="c">    <span class="s"> - </span>id (string) id of the dialog
</span></code><code id="L423"><span class="ln">423</span><span class="c">    <span class="s"> - </span>option (string) #optional get the value of ui dialog option (<b>for</b> setting a value see @$B.ui.dialog.set)
</span></code><code id="L424"><span class="ln">424</span><span class="c">    <span class="s"> = </span>(object) jQuery object of the dialog content <b>if</b> only the id is pass
</span></code><code id="L425"><span class="ln">425</span><span class="c">    <span class="s"> * </span>or <b>if</b> an option is passed
</span></code><code id="L426"><span class="ln">426</span><span class="c">    <span class="s"> = </span>(any) Value of the specified option
</span></code><code id="L427"><span class="ln">427</span><span class="c">     > Usage
</span></code><code id="L428"><span class="ln">428</span><span class="c">    <span class="s"> | </span>$B.ui.dialog.get(<i>'id'</i>)
</span></code><code id="L429"><span class="ln">429</span><span class="c">    <span class="s"> | </span>$B.ui.dialog.get(<i>'id'</i>, <i>'zIndex'</i>)
</span></code><code id="L430"><span class="ln">430</span><span class="c">    \*/</span>
</code><code id="L431"><span class="ln">431</span>    self.get<span class="s"> = </span><b>function</b> (id, option) {
</code><code id="L432"><span class="ln">432</span>      <b>if</b> (!id<span class="s"> || </span>!dialogs[id]) {
</code><code id="L433"><span class="ln">433</span>        <b>return</b> <b>false</b>;
</code><code id="L434"><span class="ln">434</span>      } <b>else</b> <b>if</b> (!option) {
</code><code id="L435"><span class="ln">435</span>        <b>return</b> dialogs[id];
</code><code id="L436"><span class="ln">436</span>      } <b>else</b> <b>if</b> (option<span class="s"> &amp;&amp; </span>helpers.isString(option)) { <span class="c">// assume options is a string containing <span class="d">1</span> option to get</span>
</code><code id="L437"><span class="ln">437</span>        <b>return</b> dialogs[id].dialog(<i>'option'</i>, option);
</code><code id="L438"><span class="ln">438</span>      }
</code><code id="L439"><span class="ln">439</span>    };
</code><code id="L440"><span class="ln">440</span>
</code><code id="L441"><span class="ln">441</span>
</code><code id="L442"><span class="ln">442</span><span class="c">    <span class="c">/*\</span>
</span></code><code id="L443"><span class="ln">443</span><span class="c">    <span class="s"> * </span>$B.ui.dialog.exists
</span></code><code id="L444"><span class="ln">444</span><span class="c">     [ method ]
</span></code><code id="L445"><span class="ln">445</span><span class="c">    <span class="s"> * </span>Tells <b>if</b> a specific dialog exists on the stack
</span></code><code id="L446"><span class="ln">446</span><span class="c">     > Arguments
</span></code><code id="L447"><span class="ln">447</span><span class="c">    <span class="s"> - </span>id (string) id of the dialog
</span></code><code id="L448"><span class="ln">448</span><span class="c">    <span class="s"> = </span>(<b>boolean</b>) True <b>if</b> the dialog exists
</span></code><code id="L449"><span class="ln">449</span><span class="c">     > Usage
</span></code><code id="L450"><span class="ln">450</span><span class="c">    <span class="s"> | </span>$B.ui.dialog.exists(<i>'myDialogID'</i>)
</span></code><code id="L451"><span class="ln">451</span><span class="c">    \*/</span>
</code><code id="L452"><span class="ln">452</span>    self.exists<span class="s"> = </span><b>function</b> (id) {
</code><code id="L453"><span class="ln">453</span>      <b>return</b> (id<span class="s"> &amp;&amp; </span>dialogs[id]);
</code><code id="L454"><span class="ln">454</span>    };
</code><code id="L455"><span class="ln">455</span>
</code><code id="L456"><span class="ln">456</span>
</code><code id="L457"><span class="ln">457</span><span class="c">    <span class="c">/*\</span>
</span></code><code id="L458"><span class="ln">458</span><span class="c">    <span class="s"> * </span>$B.ui.dialog.set
</span></code><code id="L459"><span class="ln">459</span><span class="c">     [ method ]
</span></code><code id="L460"><span class="ln">460</span><span class="c">    <span class="s"> * </span>Set an option to an existing dialog
</span></code><code id="L461"><span class="ln">461</span><span class="c">     > Arguments
</span></code><code id="L462"><span class="ln">462</span><span class="c">    <span class="s"> - </span>id (string) id of the dialog
</span></code><code id="L463"><span class="ln">463</span><span class="c">    <span class="s"> - </span>options (object) object setting the ui dialog options
</span></code><code id="L464"><span class="ln">464</span><span class="c">    <span class="s"> = </span>(object) jQuery object of the dialog content
</span></code><code id="L465"><span class="ln">465</span><span class="c">     > Usage
</span></code><code id="L466"><span class="ln">466</span><span class="c">    <span class="s"> | </span>$B.ui.dialog(<i>'id'</i>, {zIndex: <span class="d">0</span>, modal: <b>false</b>});
</span></code><code id="L467"><span class="ln">467</span><span class="c">    \*/</span>
</code><code id="L468"><span class="ln">468</span>    self.set<span class="s"> = </span><b>function</b> (id, options) {
</code><code id="L469"><span class="ln">469</span>      <span class="c">// assume options is an object to set multiple options</span>
</code><code id="L470"><span class="ln">470</span>      <b>if</b> (options<span class="s"> &amp;&amp; </span>helpers.isObject(options)) {
</code><code id="L471"><span class="ln">471</span>        <b>return</b> self.get(id).dialog(options);
</code><code id="L472"><span class="ln">472</span>      } <b>else</b> <b>if</b> (options<span class="s"> &amp;&amp; </span>helpers.isString(options)) { <span class="c">// <b>if</b> is a string <b>return</b> <span class="d">1</span> option</span>
</code><code id="L473"><span class="ln">473</span>        <b>return</b> self.get(id, options);
</code><code id="L474"><span class="ln">474</span>      }
</code><code id="L475"><span class="ln">475</span>    };
</code><code id="L476"><span class="ln">476</span>
</code><code id="L477"><span class="ln">477</span>
</code><code id="L478"><span class="ln">478</span><span class="c">    <span class="c">/*\</span>
</span></code><code id="L479"><span class="ln">479</span><span class="c">    <span class="s"> * </span>$B.ui.dialog.isOpen
</span></code><code id="L480"><span class="ln">480</span><span class="c">     [ method ]
</span></code><code id="L481"><span class="ln">481</span><span class="c">    <span class="s"> * </span>Return a <b>boolean</b> indicating wether the specified dialog is open
</span></code><code id="L482"><span class="ln">482</span><span class="c">     > Arguments
</span></code><code id="L483"><span class="ln">483</span><span class="c">    <span class="s"> - </span>id (string) id of the dialog
</span></code><code id="L484"><span class="ln">484</span><span class="c">    <span class="s"> = </span>(<b>boolean</b>) Returns <b>true</b> or <b>false</b>
</span></code><code id="L485"><span class="ln">485</span><span class="c">     > Usage
</span></code><code id="L486"><span class="ln">486</span><span class="c">    <span class="s"> | </span>$B.ui.dialog.isOpen(<i>'id'</i>);
</span></code><code id="L487"><span class="ln">487</span><span class="c">    \*/</span>
</code><code id="L488"><span class="ln">488</span>    self.isOpen<span class="s"> = </span><b>function</b> (id) {
</code><code id="L489"><span class="ln">489</span>      <b>var</b> $dialog<span class="s"> = </span>self.get(id);
</code><code id="L490"><span class="ln">490</span>      <b>if</b> ($dialog) {
</code><code id="L491"><span class="ln">491</span>        <b>return</b> $dialog.dialog(<i>'isOpen'</i>);
</code><code id="L492"><span class="ln">492</span>      }
</code><code id="L493"><span class="ln">493</span>    };
</code><code id="L494"><span class="ln">494</span>
</code><code id="L495"><span class="ln">495</span>
</code><code id="L496"><span class="ln">496</span><span class="c">    <span class="c">/*\</span>
</span></code><code id="L497"><span class="ln">497</span><span class="c">    <span class="s"> * </span>$B.ui.dialog.moveToTop
</span></code><code id="L498"><span class="ln">498</span><span class="c">     [ method ]
</span></code><code id="L499"><span class="ln">499</span><span class="c">    <span class="s"> * </span>Move a dialog to the top of the stack
</span></code><code id="L500"><span class="ln">500</span><span class="c">     > Arguments
</span></code><code id="L501"><span class="ln">501</span><span class="c">    <span class="s"> - </span>id (string) id of the dialog
</span></code><code id="L502"><span class="ln">502</span><span class="c">    <span class="s"> = </span>(object) jQuery object of the dialog content
</span></code><code id="L503"><span class="ln">503</span><span class="c">     > Usage
</span></code><code id="L504"><span class="ln">504</span><span class="c">    <span class="s"> | </span>$B.ui.dialog.moveToTop(<i>'id'</i>);
</span></code><code id="L505"><span class="ln">505</span><span class="c">    \*/</span>
</code><code id="L506"><span class="ln">506</span>    self.moveToTop<span class="s"> = </span><b>function</b> (id) {
</code><code id="L507"><span class="ln">507</span>      <b>return</b> self.get(id).dialog(<i>'moveToTop'</i>);
</code><code id="L508"><span class="ln">508</span>    };
</code><code id="L509"><span class="ln">509</span>
</code><code id="L510"><span class="ln">510</span>
</code><code id="L511"><span class="ln">511</span><span class="c">    <span class="c">/*\</span>
</span></code><code id="L512"><span class="ln">512</span><span class="c">    <span class="s"> * </span>$B.ui.dialog.destroy
</span></code><code id="L513"><span class="ln">513</span><span class="c">     [ method ]
</span></code><code id="L514"><span class="ln">514</span><span class="c">    <span class="s"> * </span>Destroy an existing dialog <b>with</b> the given id (to destroy all dialogs see @$B.ui.dialog.destroyAll)
</span></code><code id="L515"><span class="ln">515</span><span class="c">     > Arguments
</span></code><code id="L516"><span class="ln">516</span><span class="c">    <span class="s"> - </span>id (string) id of the dialog to destroy
</span></code><code id="L517"><span class="ln">517</span><span class="c">    <span class="s"> = </span>(<b>boolean</b>) returns <b>true</b> <b>if</b> success, <b>false</b> <b>if</b> no dialog to <b>delete</b>
</span></code><code id="L518"><span class="ln">518</span><span class="c">     > Usage
</span></code><code id="L519"><span class="ln">519</span><span class="c">    <span class="s"> | </span>$B.ui.dialog.destroy(<i>'id'</i>);
</span></code><code id="L520"><span class="ln">520</span><span class="c">    \*/</span>
</code><code id="L521"><span class="ln">521</span>    self.destroy<span class="s"> = </span><b>function</b> (id) {
</code><code id="L522"><span class="ln">522</span>      <b>var</b> dialogToDestroy<span class="s"> = </span>dialogs[id],
</code><code id="L523"><span class="ln">523</span>        isCore<span class="s"> = </span><b>false</b>;
</code><code id="L524"><span class="ln">524</span>
</code><code id="L525"><span class="ln">525</span>      <b>if</b> (!dialogs[id]) {
</code><code id="L526"><span class="ln">526</span>        dialogToDestroy<span class="s"> = </span>coreDialogs[id];
</code><code id="L527"><span class="ln">527</span>        <b>if</b> (dialogToDestroy) {
</code><code id="L528"><span class="ln">528</span>          isCore<span class="s"> = </span><b>true</b>;
</code><code id="L529"><span class="ln">529</span>        }
</code><code id="L530"><span class="ln">530</span>      }
</code><code id="L531"><span class="ln">531</span>
</code><code id="L532"><span class="ln">532</span>
</code><code id="L533"><span class="ln">533</span><span class="c">      /*
</span></code><code id="L534"><span class="ln">534</span><span class="c">      Esta condicion anula el metodo. Asi sirve solo para destruir la modal de loading.
</span></code><code id="L535"><span class="ln">535</span><span class="c">      Si lo comento, no funcionan modales en varios sitios. Me imagino que se esta llamando el metodo de
</span></code><code id="L536"><span class="ln">536</span><span class="c">      destrotAll en demasiados sitios. Metodo que por cierto no va hacer nada mas que quitar la modal del loading
</span></code><code id="L537"><span class="ln">537</span><span class="c">      -----------------------------------------------------------------------------------
</span></code><code id="L538"><span class="ln">538</span><span class="c">      */</span>
</code><code id="L539"><span class="ln">539</span>      <b>if</b> ((self.isOpen(id))<span class="s"> &amp;&amp; </span>(id !== <i>'loading-app'</i>)) {
</code><code id="L540"><span class="ln">540</span>        <b>return</b>;
</code><code id="L541"><span class="ln">541</span>      }
</code><code id="L542"><span class="ln">542</span>
</code><code id="L543"><span class="ln">543</span>      <b>if</b> (dialogToDestroy) {
</code><code id="L544"><span class="ln">544</span>        <span class="c">// undelegate click event that opens the dialog</span>
</code><code id="L545"><span class="ln">545</span>        privates.undelegateEvent(id, isCore);
</code><code id="L546"><span class="ln">546</span>        <span class="c">// destroy ui dialog</span>
</code><code id="L547"><span class="ln">547</span>        dialogToDestroy.dialog(<i>'destroy'</i>).remove();
</code><code id="L548"><span class="ln">548</span>        <span class="c">// <b>delete</b> from dialogs stack</span>
</code><code id="L549"><span class="ln">549</span>        privates.del(id, isCore);
</code><code id="L550"><span class="ln">550</span>
</code><code id="L551"><span class="ln">551</span>        self.disableBodyScroll(<b>false</b>);
</code><code id="L552"><span class="ln">552</span>        <b>return</b> <b>true</b>;
</code><code id="L553"><span class="ln">553</span>      }
</code><code id="L554"><span class="ln">554</span>      <b>return</b> <b>false</b>;
</code><code id="L555"><span class="ln">555</span>    };
</code><code id="L556"><span class="ln">556</span>
</code><code id="L557"><span class="ln">557</span>
</code><code id="L558"><span class="ln">558</span><span class="c">    <span class="c">/*\</span>
</span></code><code id="L559"><span class="ln">559</span><span class="c">    <span class="s"> * </span>$B.ui.dialog.destroyAll
</span></code><code id="L560"><span class="ln">560</span><span class="c">     [ method ]
</span></code><code id="L561"><span class="ln">561</span><span class="c">    <span class="s"> * </span>Destroy all dialogs that were created (to destroy a specific dialog see @$B.ui.dialog.destroy)
</span></code><code id="L562"><span class="ln">562</span><span class="c">    <span class="s"> = </span>(<b>boolean</b>) returns <b>true</b> <b>if</b> success, <b>false</b> <b>if</b> no dialogs to <b>delete</b>
</span></code><code id="L563"><span class="ln">563</span><span class="c">     > Usage
</span></code><code id="L564"><span class="ln">564</span><span class="c">    <span class="s"> | </span>$B.ui.dialog.destroyAll();
</span></code><code id="L565"><span class="ln">565</span><span class="c">    \*/</span>
</code><code id="L566"><span class="ln">566</span>    self.destroyAll<span class="s"> = </span><b>function</b> () {
</code><code id="L567"><span class="ln">567</span>      <b>var</b> id;
</code><code id="L568"><span class="ln">568</span>      <span class="c">// <b>return</b> <b>if</b> there are no dialogs</span>
</code><code id="L569"><span class="ln">569</span>      <b>if</b> ($.isEmptyObject(dialogs)) {
</code><code id="L570"><span class="ln">570</span>        <b>return</b> <b>false</b>;
</code><code id="L571"><span class="ln">571</span>      }
</code><code id="L572"><span class="ln">572</span>
</code><code id="L573"><span class="ln">573</span>      <span class="c">// <b>delete</b> all dialogs from stack</span>
</code><code id="L574"><span class="ln">574</span>      <b>for</b> (id <b>in</b> dialogs) {
</code><code id="L575"><span class="ln">575</span>        <b>if</b> (dialogs.hasOwnProperty(id)) {
</code><code id="L576"><span class="ln">576</span>          self.destroy(id);
</code><code id="L577"><span class="ln">577</span>        }
</code><code id="L578"><span class="ln">578</span>      }
</code><code id="L579"><span class="ln">579</span>      <b>return</b> <b>true</b>;
</code><code id="L580"><span class="ln">580</span>    };
</code><code id="L581"><span class="ln">581</span>
</code><code id="L582"><span class="ln">582</span>
</code><code id="L583"><span class="ln">583</span><span class="c">    <span class="c">/*\</span>
</span></code><code id="L584"><span class="ln">584</span><span class="c">    <span class="s"> * </span>$B.ui.dialog.open
</span></code><code id="L585"><span class="ln">585</span><span class="c">     [ method ]
</span></code><code id="L586"><span class="ln">586</span><span class="c">    <span class="s"> * </span>Open an existing dialog <b>with</b> the given id
</span></code><code id="L587"><span class="ln">587</span><span class="c">     > Arguments
</span></code><code id="L588"><span class="ln">588</span><span class="c">    <span class="s"> - </span>id (string) id of the dialog to open
</span></code><code id="L589"><span class="ln">589</span><span class="c">    <span class="s"> - </span>options (object) #optional object containing options to create a dialog
</span></code><code id="L590"><span class="ln">590</span><span class="c">    <span class="s"> = </span>(object) jQuery object of the dialog content
</span></code><code id="L591"><span class="ln">591</span><span class="c">     > Usage
</span></code><code id="L592"><span class="ln">592</span><span class="c">    <span class="s"> | </span>$B.ui.dialog.open(<i>'id'</i>);
</span></code><code id="L593"><span class="ln">593</span><span class="c">    <span class="s"> | </span><span class="c">// <b>if</b> an options object is passed it will be created and opened</span>
</span></code><code id="L594"><span class="ln">594</span><span class="c">    <span class="s"> | </span>$B.ui.dialog.open(<i>'MyID'</i>, {
</span></code><code id="L595"><span class="ln">595</span><span class="c">    <span class="s"> | </span>  modal: <b>true</b>,
</span></code><code id="L596"><span class="ln">596</span><span class="c">    <span class="s"> | </span>  width: <span class="d">500</span>,
</span></code><code id="L597"><span class="ln">597</span><span class="c">    <span class="s"> | </span>  height: <span class="d">300</span>
</span></code><code id="L598"><span class="ln">598</span><span class="c">    <span class="s"> | </span>});
</span></code><code id="L599"><span class="ln">599</span><span class="c">    \*/</span>
</code><code id="L600"><span class="ln">600</span>    self.open<span class="s"> = </span><b>function</b> (id, options) {
</code><code id="L601"><span class="ln">601</span>      <b>if</b> (!self.get(id)<span class="s"> &amp;&amp; </span>!options) {
</code><code id="L602"><span class="ln">602</span>        <b>throw</b> <b>new</b> Error($B.app.literals.coreLiterals.no_dialog_with_id<span class="s"> + </span>id<span class="s"> + </span>$B.app.literals.coreLiterals.no_options_for_dialog);
</code><code id="L603"><span class="ln">603</span>
</code><code id="L604"><span class="ln">604</span>      <span class="c">// <b>if</b> there is a dialog <b>with</b> that id open it</span>
</code><code id="L605"><span class="ln">605</span>      } <b>else</b> <b>if</b> (self.get(id)) {
</code><code id="L606"><span class="ln">606</span>        <span class="c">// call jQuery ui open</span>
</code><code id="L607"><span class="ln">607</span>        self.get(id).dialog(<i>'open'</i>);
</code><code id="L608"><span class="ln">608</span>
</code><code id="L609"><span class="ln">609</span>        <span class="c">// <b>return</b> dialog itself to allow chain</span>
</code><code id="L610"><span class="ln">610</span>        <b>return</b> self.get(id);
</code><code id="L611"><span class="ln">611</span>
</code><code id="L612"><span class="ln">612</span>      <span class="c">// <b>if</b> options are provided the dialog will be created and opened</span>
</code><code id="L613"><span class="ln">613</span>      } <b>else</b> <b>if</b> (options<span class="s"> &amp;&amp; </span>helpers.isObject(options)) {
</code><code id="L614"><span class="ln">614</span>        <b>if</b> (id) {
</code><code id="L615"><span class="ln">615</span>          options.id<span class="s"> = </span>id;
</code><code id="L616"><span class="ln">616</span>        }
</code><code id="L617"><span class="ln">617</span>        <span class="c">// create the dialog</span>
</code><code id="L618"><span class="ln">618</span>        <b>return</b> self.create(options).dialog(<i>'open'</i>);
</code><code id="L619"><span class="ln">619</span>      }
</code><code id="L620"><span class="ln">620</span>    };
</code><code id="L621"><span class="ln">621</span>
</code><code id="L622"><span class="ln">622</span>
</code><code id="L623"><span class="ln">623</span><span class="c">    <span class="c">/*\</span>
</span></code><code id="L624"><span class="ln">624</span><span class="c">    <span class="s"> * </span>$B.ui.dialog.close
</span></code><code id="L625"><span class="ln">625</span><span class="c">     [ method ]
</span></code><code id="L626"><span class="ln">626</span><span class="c">    <span class="s"> * </span>Close an existing dialog <b>with</b> the given id
</span></code><code id="L627"><span class="ln">627</span><span class="c">     > Arguments
</span></code><code id="L628"><span class="ln">628</span><span class="c">    <span class="s"> - </span>id (string) id of the dialog to open
</span></code><code id="L629"><span class="ln">629</span><span class="c">    <span class="s"> = </span>(object) jQuery object of the dialog content
</span></code><code id="L630"><span class="ln">630</span><span class="c">     > Usage
</span></code><code id="L631"><span class="ln">631</span><span class="c">    <span class="s"> | </span>$B.ui.dialog.close(<i>'id'</i>);
</span></code><code id="L632"><span class="ln">632</span><span class="c">    \*/</span>
</code><code id="L633"><span class="ln">633</span>    self.close<span class="s"> = </span><b>function</b> (id) {
</code><code id="L634"><span class="ln">634</span>      <b>if</b> (!self.get(id)) {
</code><code id="L635"><span class="ln">635</span>        <b>throw</b> <b>new</b> Error($B.app.literals.coreLiterals.no_dialog_with_id <span class="s"> + </span>id<span class="s"> + </span><i>"'"</i>);
</code><code id="L636"><span class="ln">636</span>      } <b>else</b> { <span class="c">// <b>if</b> there is a dialog <b>with</b> that id close it</span>
</code><code id="L637"><span class="ln">637</span>        <b>return</b> self.get(id).dialog(<i>'close'</i>); <span class="c">// allow chain returning jQuery obj</span>
</code><code id="L638"><span class="ln">638</span>      }
</code><code id="L639"><span class="ln">639</span>    };
</code><code id="L640"><span class="ln">640</span>
</code><code id="L641"><span class="ln">641</span>    self.closeActive<span class="s"> = </span><b>function</b> () {
</code><code id="L642"><span class="ln">642</span>      <b>var</b> id;
</code><code id="L643"><span class="ln">643</span>      <span class="c">// <b>return</b> <b>if</b> there are no dialogs</span>
</code><code id="L644"><span class="ln">644</span>      <b>if</b> ($.isEmptyObject(dialogs)) {
</code><code id="L645"><span class="ln">645</span>        <b>return</b> <b>false</b>;
</code><code id="L646"><span class="ln">646</span>      }
</code><code id="L647"><span class="ln">647</span>
</code><code id="L648"><span class="ln">648</span>      <span class="c">// <b>delete</b> all dialogs from stack</span>
</code><code id="L649"><span class="ln">649</span>      <b>for</b> (id <b>in</b> dialogs) {
</code><code id="L650"><span class="ln">650</span>        <b>if</b> (dialogs.hasOwnProperty(id)) {
</code><code id="L651"><span class="ln">651</span>          <b>if</b> (self.isOpen(id)) {
</code><code id="L652"><span class="ln">652</span>            self.close(id);
</code><code id="L653"><span class="ln">653</span>          }
</code><code id="L654"><span class="ln">654</span>        }
</code><code id="L655"><span class="ln">655</span>      }
</code><code id="L656"><span class="ln">656</span>      <b>return</b> <b>true</b>;
</code><code id="L657"><span class="ln">657</span>    };
</code><code id="L658"><span class="ln">658</span>
</code><code id="L659"><span class="ln">659</span>    self.showLoading<span class="s"> = </span><b>function</b> ($dialog, autofit) {
</code><code id="L660"><span class="ln">660</span>      <span class="c">// show loading <b>for</b> closing</span>
</code><code id="L661"><span class="ln">661</span>      <b>var</b> text<span class="s"> = </span>$dialog.find(<i>'.contenidoModal'</i>).attr(<i>'data-loading-text'</i>),
</code><code id="L662"><span class="ln">662</span>        modalAutoFit<span class="s"> = </span>(autofit<span class="s"> === </span><b>true</b>) ? <b>true</b> : <b>false</b>,
</code><code id="L663"><span class="ln">663</span>        closingMsg<span class="s"> = </span>_.c_v06_mensajes_cargando({ text: text<span class="s"> || </span>$B.app.literals.cargando }),
</code><code id="L664"><span class="ln">664</span>        $closeButton<span class="s"> = </span>$dialog.find(<i>'.cerrarModal'</i>).hide(),
</code><code id="L665"><span class="ln">665</span>        $cuerpoModal<span class="s"> = </span>$dialog.find(<i>'.contenedorPaso'</i>)[<span class="d">0</span>] ? $dialog.find(<i>'.contenedorPaso'</i>) : $dialog.find(<i>'.contenidoModal'</i>),
</code><code id="L666"><span class="ln">666</span>        cuerpoModalHeight<span class="s"> = </span>$cuerpoModal.outerHeight()<span class="s"> - </span><span class="d">3</span>,
</code><code id="L667"><span class="ln">667</span>        cuerpoModalWidth<span class="s"> = </span>$cuerpoModal.outerWidth()<span class="s"> - </span><span class="d">3</span>,
</code><code id="L668"><span class="ln">668</span>        $closingMsg,
</code><code id="L669"><span class="ln">669</span>        idLoading;
</code><code id="L670"><span class="ln">670</span><span class="c">     <span class="c">/* <b>if</b> ($dialog.hasClass(<i>'c-contenedores-modalDetalle'</i>)) {</span>
</span></code><code id="L671"><span class="ln">671</span><span class="c">        modalAutoFit<span class="s"> = </span><b>true</b>;
</span></code><code id="L672"><span class="ln">672</span><span class="c">      }*/</span>
</code><code id="L673"><span class="ln">673</span>      modalAutoFit<span class="s"> = </span><b>true</b>;
</code><code id="L674"><span class="ln">674</span>      $dialog.find(<i>'.scrollbarModal'</i>).hide();
</code><code id="L675"><span class="ln">675</span>
</code><code id="L676"><span class="ln">676</span>      $cuerpoModal.css({
</code><code id="L677"><span class="ln">677</span>        position: <i>'relative'</i>
</code><code id="L678"><span class="ln">678</span>      });
</code><code id="L679"><span class="ln">679</span>
</code><code id="L680"><span class="ln">680</span>      $cuerpoModal.append(closingMsg).css({position: <i>'relative'</i>});
</code><code id="L681"><span class="ln">681</span>      $closingMsg<span class="s"> = </span>$dialog.find(<i>'.c-mensajes-cargando'</i>).wrap(<i>'&lt;div <b>class</b>="jsLoadingDiv">'</i>).parent().css({
</code><code id="L682"><span class="ln">682</span>        position: <i>'absolute'</i>,
</code><code id="L683"><span class="ln">683</span>        <span class="c">//width: $dialog.width()<span class="s"> - </span><span class="d">2</span>,</span>
</code><code id="L684"><span class="ln">684</span>        width: cuerpoModalWidth,
</code><code id="L685"><span class="ln">685</span>        <span class="c">//height: cuerpoModalHeight,</span>
</code><code id="L686"><span class="ln">686</span>        height: modalAutoFit ? cuerpoModalHeight : <i>'auto'</i>,
</code><code id="L687"><span class="ln">687</span>        backgroundColor: <i>'#fff'</i>,
</code><code id="L688"><span class="ln">688</span>        <span class="c">//left: -<span class="d">9</span>,</span>
</code><code id="L689"><span class="ln">689</span>        left: <span class="d">1</span>,
</code><code id="L690"><span class="ln">690</span><span class="c">        <span class="c">/*top: (<b>function</b> () {</span>
</span></code><code id="L691"><span class="ln">691</span><span class="c">          <b>if</b> (modalAutoFit) {
</span></code><code id="L692"><span class="ln">692</span><span class="c">            <b>return</b> <span class="d">1</span>;
</span></code><code id="L693"><span class="ln">693</span><span class="c">          } <b>else</b> {
</span></code><code id="L694"><span class="ln">694</span><span class="c">            <b>return</b> Math.floor((cuerpoModalHeight<span class="s"> - </span>$dialog.find(<i>'.c-mensajes-cargando'</i>).parent().height())<span class="s"> / </span><span class="d">2</span>);
</span></code><code id="L695"><span class="ln">695</span><span class="c">          }
</span></code><code id="L696"><span class="ln">696</span><span class="c">        }())*/</span>
</code><code id="L697"><span class="ln">697</span>        top: <span class="d">1</span>
</code><code id="L698"><span class="ln">698</span>      })
</code><code id="L699"><span class="ln">699</span>        .end()
</code><code id="L700"><span class="ln">700</span>        .css({
</code><code id="L701"><span class="ln">701</span><span class="c">          <span class="c">/*position: <i>'relative'</i>,</span>
</span></code><code id="L702"><span class="ln">702</span><span class="c">          top: <i>'<span class="d">50</span>%'</i>*/</span>
</code><code id="L703"><span class="ln">703</span>          paddingTop: Math.floor(($dialog.find(<i>'.jsLoadingDiv'</i>).height()<span class="s"> - </span>$dialog.find(<i>'.c-mensajes-cargando'</i>).height())<span class="s"> / </span><span class="d">2</span>)
</code><code id="L704"><span class="ln">704</span>        });
</code><code id="L705"><span class="ln">705</span>
</code><code id="L706"><span class="ln">706</span>      idLoading<span class="s"> = </span>$B.utils.aria.loading($cuerpoModal, <i>'active'</i>);
</code><code id="L707"><span class="ln">707</span>      $cuerpoModal.find(<i>'.c-mensajes-cargando'</i>).first().attr(<i>'id'</i>, idLoading);
</code><code id="L708"><span class="ln">708</span>
</code><code id="L709"><span class="ln">709</span>      <span class="c">// separate so we can get its actual height</span>
</code><code id="L710"><span class="ln">710</span>      $closingMsg.css({
</code><code id="L711"><span class="ln">711</span>        <span class="c">//marginTop: -$closingMsg.height()</span>
</code><code id="L712"><span class="ln">712</span>      });
</code><code id="L713"><span class="ln">713</span>    };
</code><code id="L714"><span class="ln">714</span>
</code><code id="L715"><span class="ln">715</span>    self.removeLoading<span class="s"> = </span><b>function</b> ($dialog) {
</code><code id="L716"><span class="ln">716</span>      <b>var</b> $cuerpoModal<span class="s"> = </span>$dialog.find(<i>'.contenedorPaso'</i>)[<span class="d">0</span>] ? $dialog.find(<i>'.contenedorPaso'</i>) : $dialog.find(<i>'.cuerpoModal'</i>);
</code><code id="L717"><span class="ln">717</span>      $cuerpoModal.css({
</code><code id="L718"><span class="ln">718</span>        position: <i>''</i>
</code><code id="L719"><span class="ln">719</span>      });
</code><code id="L720"><span class="ln">720</span>      $dialog.find(<i>'.c-mensajes-cargando'</i>).parent().remove();
</code><code id="L721"><span class="ln">721</span>      $dialog.find(<i>'.jsLoadingDiv'</i>).remove();
</code><code id="L722"><span class="ln">722</span>      $dialog.find(<i>'.cerrarModal'</i>).show();
</code><code id="L723"><span class="ln">723</span>      $B.utils.aria.loading($cuerpoModal, <i>'inactive'</i>);
</code><code id="L724"><span class="ln">724</span>    };
</code><code id="L725"><span class="ln">725</span>
</code><code id="L726"><span class="ln">726</span>    self.disableBodyScroll<span class="s"> = </span><b>function</b> (disable) {
</code><code id="L727"><span class="ln">727</span>      $(<i>'html'</i>).css(<i>'overflow'</i>, disable ? <i>'hidden'</i> : <i>'visible'</i>);
</code><code id="L728"><span class="ln">728</span>      $(<i>'body'</i>).css(<i>'overflow'</i>, disable ? <i>'scroll'</i> : <i>'auto'</i>);
</code><code id="L729"><span class="ln">729</span>    };
</code><code id="L730"><span class="ln">730</span>
</code><code id="L731"><span class="ln">731</span>    self.focusOutsideDialog<span class="s"> = </span><b>function</b> (link) {
</code><code id="L732"><span class="ln">732</span>      <b>if</b> (link) {
</code><code id="L733"><span class="ln">733</span>        <b>if</b> (link.is(<i>'[tabindex]'</i>)) {
</code><code id="L734"><span class="ln">734</span>          link.focus();
</code><code id="L735"><span class="ln">735</span>        } <b>else</b> {
</code><code id="L736"><span class="ln">736</span>          link.closest(<i>'[tabindex]'</i>).focus();
</code><code id="L737"><span class="ln">737</span>        }
</code><code id="L738"><span class="ln">738</span>      }
</code><code id="L739"><span class="ln">739</span>    };
</code><code id="L740"><span class="ln">740</span>
</code><code id="L741"><span class="ln">741</span>
</code><code id="L742"><span class="ln">742</span><span class="c">    <span class="c">/*\</span>
</span></code><code id="L743"><span class="ln">743</span><span class="c">    <span class="s"> * </span>$B.ui.dialog.create
</span></code><code id="L744"><span class="ln">744</span><span class="c">     [ method ]
</span></code><code id="L745"><span class="ln">745</span><span class="c">    <span class="s"> * </span>Creates a ui dialog <b>with</b> given options
</span></code><code id="L746"><span class="ln">746</span><span class="c">     > Arguments
</span></code><code id="L747"><span class="ln">747</span><span class="c">    <span class="s"> - </span>options (object) object of name/value pairs
</span></code><code id="L748"><span class="ln">748</span><span class="c">     o {
</span></code><code id="L749"><span class="ln">749</span><span class="c">     o    el (string) selector <b>for</b> the element to act as a dialog (optional)
</span></code><code id="L750"><span class="ln">750</span><span class="c">     o    id (string) unique id <b>for</b> the dialog
</span></code><code id="L751"><span class="ln">751</span><span class="c">     o    content (string) string content <b>for</b> de dialog (could be the inner html of a div `$(<i>'#myDiv'</i>).html())`
</span></code><code id="L752"><span class="ln">752</span><span class="c">     o    afterLoad (callback) callback <b>function</b> to execute after loading dialog content via ajax
</span></code><code id="L753"><span class="ln">753</span><span class="c">     o    button (object, string) jQuery object or selector <b>for</b> the button that triggers the dialog
</span></code><code id="L754"><span class="ln">754</span><span class="c">     o    url (string, <b>function</b>) url string or <b>function</b> that returns a url string
</span></code><code id="L755"><span class="ln">755</span><span class="c">     o    urlParams (object, <b>function</b>) object or <b>function</b> that returns an object <b>with</b> params <b>for</b> the url
</span></code><code id="L756"><span class="ln">756</span><span class="c">     o    tagName (string) the tagName <b>for</b> creating the dialog <b>if</b> no element was provided (div by <b>default</b>)
</span></code><code id="L757"><span class="ln">757</span><span class="c">     o    dialogOptions (object) Any jQuery ui option (see jquery ui documentation)
</span></code><code id="L758"><span class="ln">758</span><span class="c">     o    onCreate (<b>function</b>) callback that fires only once when the dialog is created
</span></code><code id="L759"><span class="ln">759</span><span class="c">     o }
</span></code><code id="L760"><span class="ln">760</span><span class="c">    <span class="s"> = </span>(object) jQuery object of the dialog content
</span></code><code id="L761"><span class="ln">761</span><span class="c">     > Usage
</span></code><code id="L762"><span class="ln">762</span><span class="c">    <span class="s"> | </span>$B.ui.dialog.create({
</span></code><code id="L763"><span class="ln">763</span><span class="c">    <span class="s"> | </span>  id: <i>'MyDialog'</i>,
</span></code><code id="L764"><span class="ln">764</span><span class="c">    <span class="s"> | </span>  el: <i>'#DialogElement'</i>,
</span></code><code id="L765"><span class="ln">765</span><span class="c">    <span class="s"> | </span>  button: <i>'#button'</i>,
</span></code><code id="L766"><span class="ln">766</span><span class="c">    <span class="s"> | </span>  dialogOptions: {
</span></code><code id="L767"><span class="ln">767</span><span class="c">    <span class="s"> | </span>    draggable: <b>true</b>,
</span></code><code id="L768"><span class="ln">768</span><span class="c">    <span class="s"> | </span>    width: <span class="d">640</span>
</span></code><code id="L769"><span class="ln">769</span><span class="c">    <span class="s"> | </span>  }
</span></code><code id="L770"><span class="ln">770</span><span class="c">    <span class="s"> | </span> });
</span></code><code id="L771"><span class="ln">771</span><span class="c">    \*/</span>
</code><code id="L772"><span class="ln">772</span>    self.create<span class="s"> = </span><b>function</b> (options) {
</code><code id="L773"><span class="ln">773</span>          <span class="c">// <b>default</b> dialog <b>class</b></span>
</code><code id="L774"><span class="ln">774</span>      <b>var</b> settings,
</code><code id="L775"><span class="ln">775</span>        $dialog, <span class="c">// jQuery dialog content obj</span>
</code><code id="L776"><span class="ln">776</span>        $uiDialog, <span class="c">// placeholder <b>for</b> ui dialog element</span>
</code><code id="L777"><span class="ln">777</span>        LOADING_IMG,
</code><code id="L778"><span class="ln">778</span>        onClick,
</code><code id="L779"><span class="ln">779</span>
</code><code id="L780"><span class="ln">780</span>        <span class="c">// <b>default</b> $B.ui.dialog options</span>
</code><code id="L781"><span class="ln">781</span>        defaults<span class="s"> = </span>{
</code><code id="L782"><span class="ln">782</span>          el: <b>null</b>,
</code><code id="L783"><span class="ln">783</span>          id: <i>""</i>,
</code><code id="L784"><span class="ln">784</span>          content: <i>""</i>,
</code><code id="L785"><span class="ln">785</span>          afterLoad: <b>null</b>,
</code><code id="L786"><span class="ln">786</span>          button: <b>null</b>,
</code><code id="L787"><span class="ln">787</span>          url: <b>null</b>,
</code><code id="L788"><span class="ln">788</span>          urlParams: <b>null</b>, <span class="c">// must <b>return</b> an object</span>
</code><code id="L789"><span class="ln">789</span>          tagName: <i>'div'</i>,
</code><code id="L790"><span class="ln">790</span>          resetOnClose: <b>true</b>,
</code><code id="L791"><span class="ln">791</span>          onCreate: <b>null</b>,
</code><code id="L792"><span class="ln">792</span>          dialogClass: <i>'c-contenedores-ventanaModal'</i>,
</code><code id="L793"><span class="ln">793</span>          small: <b>false</b>,
</code><code id="L794"><span class="ln">794</span>          closeOnClick: <b>true</b>,
</code><code id="L795"><span class="ln">795</span>          <span class="c">// defaults <b>for</b> the jQuery UI dialog</span>
</code><code id="L796"><span class="ln">796</span>          dialogOptions: {
</code><code id="L797"><span class="ln">797</span>            zIndex: <span class="d">99999</span>,
</code><code id="L798"><span class="ln">798</span>            autoOpen: <b>false</b>,
</code><code id="L799"><span class="ln">799</span>            modal: <b>true</b>,
</code><code id="L800"><span class="ln">800</span>            show: <i>'fade'</i>,
</code><code id="L801"><span class="ln">801</span>            resizable: <b>false</b>,
</code><code id="L802"><span class="ln">802</span>            draggable: <b>false</b>,
</code><code id="L803"><span class="ln">803</span>            <span class="c">// custom option, save button (init on <b>false</b>)</span>
</code><code id="L804"><span class="ln">804</span>            trigger: <b>false</b>
</code><code id="L805"><span class="ln">805</span>          },
</code><code id="L806"><span class="ln">806</span>          link: <b>false</b>
</code><code id="L807"><span class="ln">807</span>        },
</code><code id="L808"><span class="ln">808</span>        _open,
</code><code id="L809"><span class="ln">809</span>        _close;
</code><code id="L810"><span class="ln">810</span>
</code><code id="L811"><span class="ln">811</span>      <span class="c">// extend dialogOptions</span>
</code><code id="L812"><span class="ln">812</span>      settings<span class="s"> = </span>$.extend(<b>true</b>, {}, defaults, options);
</code><code id="L813"><span class="ln">813</span>
</code><code id="L814"><span class="ln">814</span>      <span class="c">// not used <b>for</b> now</span>
</code><code id="L815"><span class="ln">815</span>      <b>if</b> (settings.small) {
</code><code id="L816"><span class="ln">816</span>        settings.dialogClass += <i>' w640'</i>;
</code><code id="L817"><span class="ln">817</span>      }
</code><code id="L818"><span class="ln">818</span>
</code><code id="L819"><span class="ln">819</span>      <span class="c">// check mandatory params</span>
</code><code id="L820"><span class="ln">820</span>      <b>if</b> (!settings.id) {
</code><code id="L821"><span class="ln">821</span>        <b>throw</b> <b>new</b> Error($B.app.literals.coreLiterals.provide_an_id);
</code><code id="L822"><span class="ln">822</span>      }
</code><code id="L823"><span class="ln">823</span>      <b>if</b> (dialogs[settings.id]) {
</code><code id="L824"><span class="ln">824</span>        <b>throw</b> <b>new</b> Error($B.app.literals.coreLiterals.create_the_id<span class="s"> + </span>settings.id<span class="s"> + </span><i>' '</i><span class="s"> + </span>$B.app.literals.coreLiterals.exists_choose_another);
</code><code id="L825"><span class="ln">825</span>      }
</code><code id="L826"><span class="ln">826</span>
</code><code id="L827"><span class="ln">827</span>      <span class="c">// dialog element could be a string selector or jQuery object</span>
</code><code id="L828"><span class="ln">828</span>      $dialog<span class="s"> = </span>(settings.el <b>instanceof</b> jQuery) ? settings.el : $(settings.el);
</code><code id="L829"><span class="ln">829</span>
</code><code id="L830"><span class="ln">830</span>      <span class="c">// the dialog is not on the dom and there is content provided, create the element and set its content</span>
</code><code id="L831"><span class="ln">831</span>      <b>if</b> (!$dialog[<span class="d">0</span>]<span class="s"> &amp;&amp; </span>settings.content) {
</code><code id="L832"><span class="ln">832</span>        $dialog<span class="s"> = </span>$(document.createElement(settings.tagName));
</code><code id="L833"><span class="ln">833</span>
</code><code id="L834"><span class="ln">834</span>        <span class="c">// insert provided content to the dialog must be string</span>
</code><code id="L835"><span class="ln">835</span>        <b>if</b> (settings.content<span class="s"> &amp;&amp; </span>helpers.isString(settings.content)) {
</code><code id="L836"><span class="ln">836</span>          $dialog.html(settings.content);
</code><code id="L837"><span class="ln">837</span>        } <b>else</b> {
</code><code id="L838"><span class="ln">838</span>          <b>throw</b> <b>new</b> Error($B.app.literals.coreLiterals.content_must_be_string);
</code><code id="L839"><span class="ln">839</span>        }
</code><code id="L840"><span class="ln">840</span>      } <b>else</b> <b>if</b> (!$dialog[<span class="d">0</span>]<span class="s"> &amp;&amp; </span>!settings.content) {
</code><code id="L841"><span class="ln">841</span>        <b>throw</b> <b>new</b> Error($B.app.literals.coreLiterals.the_element<span class="s"> + </span>settings.el<span class="s"> + </span>$B.app.literals.coreLiterals.not_found_on_dom);
</code><code id="L842"><span class="ln">842</span>      }
</code><code id="L843"><span class="ln">843</span>
</code><code id="L844"><span class="ln">844</span>      _open<span class="s"> = </span>settings.dialogOptions.open;
</code><code id="L845"><span class="ln">845</span>      _close<span class="s"> = </span>settings.dialogOptions.close;
</code><code id="L846"><span class="ln">846</span>
</code><code id="L847"><span class="ln">847</span>      settings.dialogOptions.close<span class="s"> = </span><b>function</b> () {
</code><code id="L848"><span class="ln">848</span>        self.disableBodyScroll(<b>false</b>);
</code><code id="L849"><span class="ln">849</span>        <b>if</b> (helpers.isFunction(_close)) {
</code><code id="L850"><span class="ln">850</span>          _close.apply($dialog[<span class="d">0</span>], arguments);
</code><code id="L851"><span class="ln">851</span>        }
</code><code id="L852"><span class="ln">852</span>        self.focusOutsideDialog(settings.link);
</code><code id="L853"><span class="ln">853</span>      };
</code><code id="L854"><span class="ln">854</span>      settings.dialogOptions.destroy<span class="s"> = </span><b>function</b> () {
</code><code id="L855"><span class="ln">855</span>        self.focusOutsideDialog(settings.link);
</code><code id="L856"><span class="ln">856</span>      };
</code><code id="L857"><span class="ln">857</span>
</code><code id="L858"><span class="ln">858</span>      settings.dialogOptions.open<span class="s"> = </span><b>function</b> () {
</code><code id="L859"><span class="ln">859</span>        self.disableBodyScroll(<b>true</b>);
</code><code id="L860"><span class="ln">860</span>        $B.ui.dialogCenter();
</code><code id="L861"><span class="ln">861</span>        <b>if</b> (helpers.isFunction(_open)) {
</code><code id="L862"><span class="ln">862</span>          _open.apply($dialog[<span class="d">0</span>], arguments);
</code><code id="L863"><span class="ln">863</span>        }
</code><code id="L864"><span class="ln">864</span>      };
</code><code id="L865"><span class="ln">865</span>
</code><code id="L866"><span class="ln">866</span>
</code><code id="L867"><span class="ln">867</span>      <span class="c">// initialize jquery ui dialog <b>with</b> options provided</span>
</code><code id="L868"><span class="ln">868</span>      $dialog
</code><code id="L869"><span class="ln">869</span>        .dialog(settings.dialogOptions)
</code><code id="L870"><span class="ln">870</span>        .on(<i>'click.dialog-accept'</i>, <i>'[data-dialog-accept]'</i>, <b>function</b> (event) {
</code><code id="L871"><span class="ln">871</span>          <b>if</b> ($(event.currentTarget).hasClass(<i>'inactivo'</i>)<span class="s"> || </span>$(event.currentTarget).hasClass(<i>'inactivoValidacion'</i>)) {
</code><code id="L872"><span class="ln">872</span>            <b>return</b> <b>false</b>;
</code><code id="L873"><span class="ln">873</span>          }
</code><code id="L874"><span class="ln">874</span>
</code><code id="L875"><span class="ln">875</span>          $dialog.dialog(<i>'close'</i>);
</code><code id="L876"><span class="ln">876</span>          <span class="c">// <b>if</b> there is an accept <b>function</b> defined on the options, call it</span>
</code><code id="L877"><span class="ln">877</span>          <b>if</b> (settings.accept<span class="s"> &amp;&amp; </span>helpers.isFunction(settings.accept)) {
</code><code id="L878"><span class="ln">878</span>            settings.accept.call($dialog, event);
</code><code id="L879"><span class="ln">879</span>          }
</code><code id="L880"><span class="ln">880</span>        })
</code><code id="L881"><span class="ln">881</span>        .on(<i>'click.dialog-close-error'</i>, <i>'[data-cidview-associated]'</i>, <b>function</b> (event) {
</code><code id="L882"><span class="ln">882</span>          <span class="c">// call the same <b>function</b> of appView that closes error msg</span>
</code><code id="L883"><span class="ln">883</span>          $B.router.appView.reloadView(event);
</code><code id="L884"><span class="ln">884</span>        });
</code><code id="L885"><span class="ln">885</span>
</code><code id="L886"><span class="ln">886</span>      <b>if</b> (settings.closeOnClick) {
</code><code id="L887"><span class="ln">887</span>        $dialog.on(<i>'click.dialog-close'</i>, <i>'[data-dialog-close], [data-dialog-cancel]'</i>, <b>function</b> () {
</code><code id="L888"><span class="ln">888</span>          $dialog.dialog(<i>'close'</i>);
</code><code id="L889"><span class="ln">889</span>        });
</code><code id="L890"><span class="ln">890</span>      }
</code><code id="L891"><span class="ln">891</span>
</code><code id="L892"><span class="ln">892</span>      <span class="c">// External stuff</span>
</code><code id="L893"><span class="ln">893</span>      $B.ui.initFormComponents($dialog);
</code><code id="L894"><span class="ln">894</span>      $B.ui.c_buscadores_predictivoLiquido($dialog.find(<i>'.c-buscadores-predictivo-liquido'</i>));
</code><code id="L895"><span class="ln">895</span>      <span class="c">// end External stuff</span>
</code><code id="L896"><span class="ln">896</span>
</code><code id="L897"><span class="ln">897</span>      <span class="c">// get ui dialog element</span>
</code><code id="L898"><span class="ln">898</span>      $uiDialog<span class="s"> = </span>$($dialog.data(<i>'dialog'</i>).uiDialog).attr(<i>'id'</i>, <i>'ui-dialog-'</i><span class="s"> + </span>settings.id).addClass(settings.dialogClass);
</code><code id="L899"><span class="ln">899</span>
</code><code id="L900"><span class="ln">900</span>      <b>if</b> (settings.dialogOptions.height<span class="s"> &amp;&amp; </span>_.isNumber(settings.dialogOptions.height)) {
</code><code id="L901"><span class="ln">901</span>        $uiDialog.attr(<i>'data-fixed-height'</i>, settings.dialogOptions.height);
</code><code id="L902"><span class="ln">902</span>      }
</code><code id="L903"><span class="ln">903</span>
</code><code id="L904"><span class="ln">904</span>      <b>if</b> (settings.dialogClass !== <i>'c-contenedores-modalDetalle'</i>) {
</code><code id="L905"><span class="ln">905</span>        <b>if</b> (settings.dialogOptions.width &lt; <span class="d">700</span>) {
</code><code id="L906"><span class="ln">906</span>          <span class="c">// pequenyo</span>
</code><code id="L907"><span class="ln">907</span>          $uiDialog.addClass(<i>'w640'</i>);
</code><code id="L908"><span class="ln">908</span>          $dialog.find(<i>'.cuerpoModal'</i>).addClass(<i>'container_8'</i>);
</code><code id="L909"><span class="ln">909</span>        } <b>else</b> {
</code><code id="L910"><span class="ln">910</span>          <span class="c">// grande</span>
</code><code id="L911"><span class="ln">911</span>          $dialog.find(<i>'.cuerpoModal'</i>).addClass(<i>'container_12'</i>);
</code><code id="L912"><span class="ln">912</span>        }
</code><code id="L913"><span class="ln">913</span>      }
</code><code id="L914"><span class="ln">914</span>
</code><code id="L915"><span class="ln">915</span>      <span class="c">// set dialog width from its data-dialog-width attribute</span>
</code><code id="L916"><span class="ln">916</span>      <span class="c">// must be a <b>class</b> e.i. data-dialog-width=<i>"w640"</i></span>
</code><code id="L917"><span class="ln">917</span>      privates.setWidth($dialog, $uiDialog);
</code><code id="L918"><span class="ln">918</span>
</code><code id="L919"><span class="ln">919</span>      <span class="c">// attach event handler to fix tab to the dialog when opened</span>
</code><code id="L920"><span class="ln">920</span>      privates.fixDialogTabbing($dialog, $uiDialog);
</code><code id="L921"><span class="ln">921</span>
</code><code id="L922"><span class="ln">922</span>      <span class="c">// add to dialogs stack</span>
</code><code id="L923"><span class="ln">923</span>      privates.add(settings.id, $dialog, settings.isCore);
</code><code id="L924"><span class="ln">924</span>
</code><code id="L925"><span class="ln">925</span>      <span class="c">// <b>if</b> resetOnClose is <b>true</b> (by <b>default</b> it is), resets the form inside the dialog</span>
</code><code id="L926"><span class="ln">926</span>      <b>if</b> (settings.resetOnClose) {
</code><code id="L927"><span class="ln">927</span>        privates.reset($dialog);
</code><code id="L928"><span class="ln">928</span>      }
</code><code id="L929"><span class="ln">929</span>
</code><code id="L930"><span class="ln">930</span>      <span class="c">// call onCreate callback (run once when modal is created)</span>
</code><code id="L931"><span class="ln">931</span>      <b>if</b> (settings.onCreate<span class="s"> &amp;&amp; </span>helpers.isFunction(settings.onCreate)) {
</code><code id="L932"><span class="ln">932</span>        settings.onCreate.call($dialog);
</code><code id="L933"><span class="ln">933</span>      }
</code><code id="L934"><span class="ln">934</span>
</code><code id="L935"><span class="ln">935</span>      <span class="c">// TODO:</span>
</code><code id="L936"><span class="ln">936</span>      <span class="c">// loading image/element</span>
</code><code id="L937"><span class="ln">937</span>      LOADING_IMG<span class="s"> = </span><i>''</i>;<span class="c">// $(<i>'&lt;div <b>class</b>="ui-helper-hidden">Cargando...&lt;/div>'</i>).insertBefore($dialog);</span>
</code><code id="L938"><span class="ln">938</span>
</code><code id="L939"><span class="ln">939</span>      <span class="c">// <b>if</b> there is an element defined to open the dialog, attach click event</span>
</code><code id="L940"><span class="ln">940</span>      <b>if</b> (settings.button) {
</code><code id="L941"><span class="ln">941</span>        <span class="c">// <b>if</b> is not a jQuery obj but a string selector wrap it <b>with</b> jQuery</span>
</code><code id="L942"><span class="ln">942</span>
</code><code id="L943"><span class="ln">943</span>        <b>if</b> (!helpers.isString(settings.button)) {
</code><code id="L944"><span class="ln">944</span>          <b>throw</b> <b>new</b> Error($B.app.literals.coreLiterals.button_must_be_string);
</code><code id="L945"><span class="ln">945</span>        }
</code><code id="L946"><span class="ln">946</span>
</code><code id="L947"><span class="ln">947</span>        <span class="c">// <b>default</b> click <b>function</b> <b>for</b> opening the dialog</span>
</code><code id="L948"><span class="ln">948</span>        onClick<span class="s"> = </span><b>function</b> (ev) {
</code><code id="L949"><span class="ln">949</span>          ev.preventDefault();
</code><code id="L950"><span class="ln">950</span>
</code><code id="L951"><span class="ln">951</span>          <b>var</b> $trigger<span class="s"> = </span>$(<b>this</b>);
</code><code id="L952"><span class="ln">952</span>
</code><code id="L953"><span class="ln">953</span>          <span class="c">// open the dialog</span>
</code><code id="L954"><span class="ln">954</span>          <span class="c">// save a referece of the element that triggered <b>this</b> dialog</span>
</code><code id="L955"><span class="ln">955</span>          $dialog
</code><code id="L956"><span class="ln">956</span>            .dialog({trigger: { btn: $trigger, selector: settings.button }})
</code><code id="L957"><span class="ln">957</span>            .dialog(<i>'open'</i>);
</code><code id="L958"><span class="ln">958</span>
</code><code id="L959"><span class="ln">959</span>          <span class="c">// <b>if</b> there is a url provided load the dialog content from there</span>
</code><code id="L960"><span class="ln">960</span>          <b>if</b> (settings.url) {
</code><code id="L961"><span class="ln">961</span>            <span class="c">// allow the url be a <b>function</b></span>
</code><code id="L962"><span class="ln">962</span>            <b>if</b> (helpers.isFunction(settings.url)) {
</code><code id="L963"><span class="ln">963</span>              settings.url<span class="s"> = </span>settings.url.call(<b>this</b>);
</code><code id="L964"><span class="ln">964</span>              <b>if</b> (!helpers.isString(settings.url)) {
</code><code id="L965"><span class="ln">965</span>                <b>throw</b> <b>new</b> Error($B.app.literals.coreLiterals.url_must_be_string);
</code><code id="L966"><span class="ln">966</span>              }
</code><code id="L967"><span class="ln">967</span>            }
</code><code id="L968"><span class="ln">968</span>            self.load.call($dialog, settings);
</code><code id="L969"><span class="ln">969</span>          } <b>else</b> <b>if</b> (settings.ajax) { <span class="c">// <b>if</b> ajax is <b>true</b> get the url from the href attribute or from data-dialog-url</span>
</code><code id="L970"><span class="ln">970</span>            settings.url<span class="s"> = </span>$trigger.attr(<i>"href"</i>)<span class="s"> || </span>$trigger.data(<i>"dialog-url"</i>);
</code><code id="L971"><span class="ln">971</span>            <span class="c">// <b>if</b> we couldn't get the url from href</span>
</code><code id="L972"><span class="ln">972</span>            <b>if</b> (!settings.url) {
</code><code id="L973"><span class="ln">973</span>              <b>throw</b> <b>new</b> Error($B.app.literals.coreLiterals.specify_a_url);
</code><code id="L974"><span class="ln">974</span>            }
</code><code id="L975"><span class="ln">975</span>            self.load.call($dialog, settings);
</code><code id="L976"><span class="ln">976</span>          }
</code><code id="L977"><span class="ln">977</span>        };
</code><code id="L978"><span class="ln">978</span>
</code><code id="L979"><span class="ln">979</span>        <span class="c">// save a referece of the element that triggered <b>this</b> dialog (as a string <b>if</b> not opened yet)</span>
</code><code id="L980"><span class="ln">980</span>        $dialog.dialog({trigger: { btn: $(settings.button), selector: settings.button }});
</code><code id="L981"><span class="ln">981</span>
</code><code id="L982"><span class="ln">982</span>        <span class="c">// delegate click event from document</span>
</code><code id="L983"><span class="ln">983</span>        $(document).on(<i>'click.b-dialog-open'</i>, settings.button, onClick);
</code><code id="L984"><span class="ln">984</span>
</code><code id="L985"><span class="ln">985</span>      <span class="c">// no button provided</span>
</code><code id="L986"><span class="ln">986</span>      } <b>else</b> <b>if</b> (settings.ajax<span class="s"> || </span>settings.url) {
</code><code id="L987"><span class="ln">987</span>        <span class="c">// load content on open</span>
</code><code id="L988"><span class="ln">988</span>        $dialog.dialog({
</code><code id="L989"><span class="ln">989</span>          open: <b>function</b> (ev, ui) {
</code><code id="L990"><span class="ln">990</span>            self.load.call($dialog, settings);
</code><code id="L991"><span class="ln">991</span>          }
</code><code id="L992"><span class="ln">992</span>        });
</code><code id="L993"><span class="ln">993</span>
</code><code id="L994"><span class="ln">994</span>      <span class="c">// no ajax or url</span>
</code><code id="L995"><span class="ln">995</span>      } <b>else</b> {
</code><code id="L996"><span class="ln">996</span>        $dialog.dialog();
</code><code id="L997"><span class="ln">997</span>      }
</code><code id="L998"><span class="ln">998</span>
</code><code id="L999"><span class="ln">999</span>      $B.ui.dialogCenter();
</code><code id="L1000"><span class="ln">1000</span>
</code><code id="L1001"><span class="ln">1001</span>      <b>return</b> $dialog;
</code><code id="L1002"><span class="ln">1002</span>    };
</code><code id="L1003"><span class="ln">1003</span>
</code><code id="L1004"><span class="ln">1004</span>
</code><code id="L1005"><span class="ln">1005</span>    self.load<span class="s"> = </span><b>function</b> (settings) {
</code><code id="L1006"><span class="ln">1006</span>      <b>var</b> $dialog<span class="s"> = </span><b>this</b>,
</code><code id="L1007"><span class="ln">1007</span>        loadingImg<span class="s"> = </span>$dialog.prev().show(), <span class="c">// show loading img</span>
</code><code id="L1008"><span class="ln">1008</span>        <span class="c">// allow params to be a <b>function</b></span>
</code><code id="L1009"><span class="ln">1009</span>        _dataToSend<span class="s"> = </span>(settings.urlParams) ? helpers.isFunction(settings.urlParams) ? settings.urlParams() : settings.urlParams : {};
</code><code id="L1010"><span class="ln">1010</span>
</code><code id="L1011"><span class="ln">1011</span>      <b>if</b> (_dataToSend<span class="s"> &amp;&amp; </span>!helpers.isObject(_dataToSend)) {
</code><code id="L1012"><span class="ln">1012</span>        <b>throw</b> <b>new</b> Error($B.app.literals.coreLiterals.urlParams_must_be_object);
</code><code id="L1013"><span class="ln">1013</span>      }
</code><code id="L1014"><span class="ln">1014</span>
</code><code id="L1015"><span class="ln">1015</span>      <span class="c">// prevent url caching adding a timestamp</span>
</code><code id="L1016"><span class="ln">1016</span>      <b>if</b> (!settings.cache) {
</code><code id="L1017"><span class="ln">1017</span>        _dataToSend.t<span class="s"> = </span><b>new</b> Date().getTime();
</code><code id="L1018"><span class="ln">1018</span>      }
</code><code id="L1019"><span class="ln">1019</span>
</code><code id="L1020"><span class="ln">1020</span>      <span class="c">// empty any dialog content and load the <b>new</b> one</span>
</code><code id="L1021"><span class="ln">1021</span>      $dialog.empty().load(settings.url, _dataToSend, <b>function</b> (response, status, xhr) {
</code><code id="L1022"><span class="ln">1022</span>        <span class="c">// hide loading img</span>
</code><code id="L1023"><span class="ln">1023</span>        loadingImg.hide();
</code><code id="L1024"><span class="ln">1024</span>
</code><code id="L1025"><span class="ln">1025</span>        <span class="c">// <b>if</b> status <span class="d">401</span> redirect to login</span>
</code><code id="L1026"><span class="ln">1026</span>        <b>if</b> (xhr.status<span class="s"> === </span><span class="d">401</span>) {
</code><code id="L1027"><span class="ln">1027</span>          location.reload();
</code><code id="L1028"><span class="ln">1028</span>          <b>return</b> <b>false</b>;
</code><code id="L1029"><span class="ln">1029</span>        } <b>else</b> <b>if</b> (xhr.status<span class="s"> === </span><span class="d">500</span>) { <span class="c">// show error on <span class="d">500</span></span>
</code><code id="L1030"><span class="ln">1030</span>          $dialog.html(<i>'&lt;p>'</i><span class="s"> + </span>$B.app.literals.error_msg<span class="s"> + </span><i>'&lt;/p>'</i>);
</code><code id="L1031"><span class="ln">1031</span>          <b>return</b> <b>false</b>;
</code><code id="L1032"><span class="ln">1032</span>        } <b>else</b> <b>if</b> (settings.afterLoad<span class="s"> &amp;&amp; </span>helpers.isFunction(settings.afterLoad)) { <span class="c">// all ok call afterLoad fn <b>if</b> defined</span>
</code><code id="L1033"><span class="ln">1033</span>          <span class="c">// pass the dialog elem as context</span>
</code><code id="L1034"><span class="ln">1034</span>          settings.afterLoad.apply($dialog, arguments);
</code><code id="L1035"><span class="ln">1035</span>        }
</code><code id="L1036"><span class="ln">1036</span>      });
</code><code id="L1037"><span class="ln">1037</span>    };
</code><code id="L1038"><span class="ln">1038</span>
</code><code id="L1039"><span class="ln">1039</span>    <b>return</b> self;
</code><code id="L1040"><span class="ln">1040</span>  }());
</code><code id="L1041"><span class="ln">1041</span>}(jQuery, window));
</code></body>